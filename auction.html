<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï∞∏Ïä§ ÏΩîÎìú ÌîÑÎ°úÍ∑∏Îû® (Compact Ver)</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --ow-orange: #D97706;
            --ow-blue: #2563EB;
            --ow-dark: #FFFFFF;
            --ow-darker: #EFF6FF;
            --ow-gray: #F8FAFC;
            --ow-white: #0F172A;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--ow-darker);
            min-height: 100vh;
            color: var(--ow-white);
            overflow-x: hidden;
        }
        .hex-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background: linear-gradient(135deg, rgba(37,99,235,0.04) 0%, transparent 50%),
                        linear-gradient(225deg, rgba(217,119,6,0.04) 0%, transparent 50%), var(--ow-darker);
        }
        .hex-pattern {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%232563eb' fill-opacity='0.3'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 {
            font-family: 'Orbitron', sans-serif; font-size: 2em; font-weight: 900; letter-spacing: 0.1em;
            background: linear-gradient(135deg, var(--ow-blue), #0F172A, var(--ow-orange));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .header-subtitle { font-size: 0.9em; color: #94A3B8; letter-spacing: 0.2em; }
        
        .controls {
            background: rgba(255,255,255,0.8); border: 1px solid #DBEAFE;
            padding: 15px; border-radius: 8px; margin-bottom: 20px; position: relative;
            backdrop-filter: blur(12px);
            box-shadow: 0 2px 12px rgba(15,23,42,0.04);
        }
        .controls::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--ow-blue), var(--ow-orange), transparent);
        }
        .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        .btn {
            font-family: 'Orbitron', sans-serif; padding: 10px 20px; border: none; border-radius: 8px;
            font-size: 11px; font-weight: 700; cursor: pointer; transition: all 0.3s; text-transform: uppercase;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .btn-balanced { background: linear-gradient(135deg, var(--ow-blue), #0EA5E9); color: white; }
        .btn-spectator { background: linear-gradient(135deg, #7C3AED, #6D28D9); color: white; }
        .btn-auction { background: linear-gradient(135deg, var(--ow-orange), #B45309); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #DC2626, #B91C1C); color: white; }
        .btn-reset-spectator { background: linear-gradient(135deg, #6B7280, #4B5563); color: white; }
        .btn-add-all { background: linear-gradient(135deg, #059669, #047857); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,0,0,0.12); }
        
        .teams-container {
            background: rgba(255,255,255,0.7); border: 1px solid #E2E8F0;
            padding: 20px; border-radius: 12px; margin-bottom: 20px;
            backdrop-filter: blur(12px);
            box-shadow: 0 2px 12px rgba(15,23,42,0.04);
        }
        .teams-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: start; margin-bottom: 20px; }
        .team { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 1px 6px rgba(15,23,42,0.06); }
        .team-1 { border: 2px solid var(--ow-blue); box-shadow: 0 0 20px rgba(37,99,235,0.08); }
        .team-2 { border: 2px solid var(--ow-orange); box-shadow: 0 0 20px rgba(217,119,6,0.08); }
        .team-header {
            font-family: 'Orbitron', sans-serif; font-size: 1.3em; font-weight: 700;
            margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #E2E8F0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .team-1 .team-header { color: var(--ow-blue); }
        .team-2 .team-header { color: var(--ow-orange); }
        .team-stats { display: flex; gap: 10px; }
        .team-score, .team-points {
            font-family: 'Orbitron', sans-serif; font-size: 0.6em;
            padding: 6px 10px; border-radius: 6px;
        }
        .team-score { background: #F1F5F9; color: #334155; }
        .team-points { background: linear-gradient(135deg, #d53f8c, #9d4edd); color: white; }
        
        .team-slots { display: flex; flex-direction: column; gap: 8px; min-height: 400px; }
        .team-slot {
            background: #F8FAFC; border: 2px dashed #CBD5E1;
            padding: 0; border-radius: 8px; 
            height: 60px;
            display: flex; align-items: center; justify-content: center; transition: all 0.3s;
            position: relative; overflow: hidden;
        }
        .team-slot.drag-over { background: #EFF6FF; border-style: solid; border-color: var(--ow-blue); }
        .team-slot.empty::after {
            content: 'Îπà Ïä¨Î°Ø'; font-family: 'Orbitron', sans-serif;
            color: #CBD5E1; font-size: 0.85em;
        }
        
        .player-card {
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #F8FAFC, #FFFFFF);
            border: 1px solid #E2E8F0; border-radius: 8px;
            padding: 0 12px;
            cursor: grab; transition: all 0.3s;
            display: flex; align-items: center;
        }
        .player-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(15,23,42,0.08); }
        .player-card.dragging { opacity: 0.3; }
        .player-card.is-leader { border: 2px solid #EAB308; box-shadow: 0 0 12px rgba(234,179,8,0.2); }
        .player-card-content { display: flex; align-items: center; gap: 10px; width: 100%; }
        .player-role-icon {
            font-size: 1.5em; width: 36px; height: 36px;
            display: flex; align-items: center; justify-content: center;
            background: #F1F5F9; border-radius: 50%; cursor: pointer;
            transition: all 0.2s;
        }
        .player-role-icon:hover { background: #E2E8F0; transform: scale(1.1); }
        .player-info { flex: 1; }
        .player-name { font-family: 'Orbitron', sans-serif; font-size: 1em; font-weight: 700; color: #0F172A; display: flex; align-items: center; gap: 6px; }
        .leader-badge { font-size: 0.7em; background: #EAB308; color: #422006; padding: 1px 4px; border-radius: 3px; }
        .player-meta { display: flex; gap: 6px; margin-top: 2px; }
        .tier-badge {
            font-family: 'Orbitron', sans-serif; font-size: 0.7em;
            padding: 2px 6px; border-radius: 3px; font-weight: 700;
        }
        .tier-bronze { background: linear-gradient(135deg, #cd7f32, #8b4513); color: white; }
        .tier-silver { background: linear-gradient(135deg, #c0c0c0, #808080); color: #333; }
        .tier-gold { background: linear-gradient(135deg, #ffd700, #daa520); color: #333; }
        .tier-platinum { background: linear-gradient(135deg, #00d4aa, #00a085); color: white; }
        .tier-diamond { background: linear-gradient(135deg, #60A5FA, #3B82F6); color: white; }
        .role-badge {
            font-size: 0.7em; padding: 2px 6px; border-radius: 3px;
            background: #F1F5F9; font-weight: 600; color: #475569;
        }
        
        .vs-divider { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .vs-text {
            font-family: 'Orbitron', sans-serif; font-size: 2.5em; font-weight: 900;
            background: linear-gradient(180deg, var(--ow-blue), var(--ow-orange));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .score-diff {
            font-family: 'Orbitron', sans-serif; font-size: 0.85em;
            background: #F1F5F9; padding: 8px 15px; border-radius: 6px; color: #475569;
        }
        .score-diff.balanced { background: rgba(5,150,105,0.1); border: 1px solid #059669; color: #059669; }
        
        .spectators {
            background: white; border: 2px solid rgba(124,58,237,0.25);
            border-radius: 10px; padding: 15px;
            box-shadow: 0 1px 6px rgba(15,23,42,0.04);
        }
        .spectators-header {
            font-family: 'Orbitron', sans-serif; font-size: 1.1em; font-weight: 700;
            color: #7C3AED; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .spectator-count { font-size: 0.7em; background: rgba(124,58,237,0.1); color: #7C3AED; padding: 4px 10px; border-radius: 4px; }
        
        .spectators-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 8px; min-height: 150px; align-content: start;
            padding: 5px; border-radius: 6px;
        }
        .spectators-grid.drag-over { background: rgba(124,58,237,0.06); border: 2px dashed rgba(124,58,237,0.3); }
        .spectators-grid.empty::after {
            content: 'Í¥ÄÏ†ÑÏûê ÏóÜÏùå'; font-family: 'Orbitron', sans-serif;
            color: #CBD5E1; display: flex; align-items: center;
            justify-content: center; height: 100%; grid-column: 1 / -1;
        }
        
        .spectator-card {
            background: linear-gradient(135deg, #7C3AED, #6D28D9);
            border-radius: 8px; padding: 10px; cursor: grab; transition: all 0.3s; position: relative;
            color: white;
        }
        .spectator-card:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(124,58,237,0.25); }
        .spectator-card .remove-spectator-btn {
            position: absolute; top: 4px; right: 4px;
            background: rgba(239,68,68,0.8); border: none; color: white;
            width: 20px; height: 20px; border-radius: 50%; cursor: pointer; font-size: 10px;
        }
        .spectator-card .remove-spectator-btn:hover { background: #dc2626; }
        .spectator-name { font-family: 'Orbitron', sans-serif; font-size: 0.95em; font-weight: 700; margin-bottom: 4px; color: white; }
        .spectator-meta { display: flex; gap: 4px; flex-wrap: wrap; }
        .spectator-tier, .spectator-role {
            font-size: 0.7em; padding: 2px 6px; border-radius: 3px;
            background: rgba(255,255,255,0.2); font-weight: 600; cursor: pointer; color: white;
        }
        .spectator-tier:hover, .spectator-role:hover { background: rgba(255,255,255,0.35); }
        
        .player-list-container {
            background: rgba(255,255,255,0.7); border: 1px solid #E2E8F0;
            padding: 20px; border-radius: 12px; margin-bottom: 20px;
            backdrop-filter: blur(12px);
            box-shadow: 0 2px 12px rgba(15,23,42,0.04);
        }
        .section-title { font-family: 'Orbitron', sans-serif; font-size: 1em; font-weight: 700; margin-bottom: 10px; color: #0F172A; }
        .saved-players {
            display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;
            min-height: 40px; padding: 10px; background: #F8FAFC;
            border-radius: 8px; border: 1px dashed #CBD5E1;
        }
        .saved-player-tag {
            background: linear-gradient(135deg, var(--ow-blue), #0EA5E9); color: white;
            padding: 6px 10px; border-radius: 6px; font-size: 0.85em; font-weight: 600;
            display: flex; align-items: center; gap: 6px; cursor: pointer; transition: all 0.3s;
        }
        .saved-player-tag.selectable:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(37,99,235,0.25); }
        .saved-player-tag.in-spectator { background: linear-gradient(135deg, #7C3AED, #6D28D9); cursor: default; }
        .saved-player-tag.in-team { background: linear-gradient(135deg, #94A3B8, #64748B); opacity: 0.6; cursor: default; }
        .saved-player-tag .tier-badge-small {
            background: rgba(255,255,255,0.3); padding: 2px 6px; border-radius: 3px;
            font-size: 0.8em; font-weight: 700; cursor: pointer; color: white;
        }
        .saved-player-tag .tier-badge-small:hover { background: rgba(255,255,255,0.5); }
        .saved-player-tag .remove-btn {
            background: rgba(255,255,255,0.2); border: none; color: white;
            width: 18px; height: 18px; border-radius: 50%; cursor: pointer; font-size: 9px;
        }
        .saved-player-tag .remove-btn:hover { background: #dc2626; }
        .add-player-section { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .player-name-input, .tier-input {
            background: white; border: 2px solid #E2E8F0;
            color: #0F172A; padding: 8px 10px; border-radius: 8px; font-size: 0.9em;
        }
        .player-name-input:focus, .tier-input:focus { outline: none; border-color: var(--ow-blue); }
        .player-name-input { flex: 1; min-width: 150px; }
        .tier-input { width: 60px; text-align: center; }
        .tier-input-label { color: #64748B; font-weight: 600; font-size: 0.9em; }
        .add-player-btn {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #059669, #047857); color: white;
            border: none; padding: 8px 16px; border-radius: 8px; font-size: 0.8em;
            font-weight: 700; cursor: pointer; transition: all 0.3s;
        }
        .add-player-btn:hover { transform: translateY(-2px); }
        .info-message {
            background: rgba(37,99,235,0.06); border: 1px solid rgba(37,99,235,0.15);
            padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.85em; color: #64748B;
        }
        
        /* Ïä§ÌÅ¨Î¶∞ÏÉ∑ ÏóÖÎ°úÎìú ÏòÅÏó≠ */
        .screenshot-section {
            margin-top: 15px; padding: 15px;
            background: rgba(217,119,6,0.04); border: 2px dashed rgba(217,119,6,0.25);
            border-radius: 10px; transition: all 0.3s; position: relative;
        }
        .screenshot-section.drag-highlight {
            background: rgba(217,119,6,0.1); border-color: var(--ow-orange);
            box-shadow: 0 0 20px rgba(217,119,6,0.1);
        }
        .screenshot-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .screenshot-title { font-family: 'Orbitron', sans-serif; font-size: 0.9em; font-weight: 700; color: var(--ow-orange); }
        .screenshot-desc { font-size: 0.8em; color: #94A3B8; }
        .screenshot-upload-area {
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            padding: 20px; cursor: pointer; text-align: center;
        }
        .screenshot-upload-area .upload-icon { font-size: 2em; }
        .screenshot-upload-area .upload-text { font-size: 0.85em; color: #94A3B8; }
        .screenshot-upload-area .upload-text strong { color: var(--ow-orange); }
        #screenshotFileInput { display: none; }
        .screenshot-preview-area {
            display: none; gap: 15px; align-items: flex-start;
        }
        .screenshot-preview-area.active { display: flex; }
        .screenshot-preview {
            max-width: 200px; max-height: 200px; border-radius: 8px;
            border: 1px solid #E2E8F0; flex-shrink: 0;
        }
        .screenshot-names-area { flex: 1; }
        .screenshot-names-textarea {
            width: 100%; min-height: 100px; background: white;
            border: 2px solid #E2E8F0; color: #0F172A;
            padding: 10px; border-radius: 8px; font-size: 0.9em; font-family: 'Rajdhani', sans-serif;
            resize: vertical;
        }
        .screenshot-names-textarea:focus { outline: none; border-color: var(--ow-orange); }
        .screenshot-actions { display: flex; gap: 8px; margin-top: 8px; }
        .screenshot-btn {
            font-family: 'Orbitron', sans-serif; padding: 8px 16px; border: none;
            border-radius: 8px; font-size: 0.8em; font-weight: 700; cursor: pointer; transition: all 0.3s;
        }
        .screenshot-btn.apply { background: linear-gradient(135deg, var(--ow-orange), #B45309); color: white; }
        .screenshot-btn.cancel { background: #F1F5F9; color: #64748B; border: 1px solid #E2E8F0; }
        .screenshot-btn:hover { transform: translateY(-2px); }
        .screenshot-loading {
            display: none; align-items: center; gap: 10px; padding: 20px; justify-content: center;
            color: #475569;
        }
        .screenshot-loading.active { display: flex; }
        .screenshot-loading .spinner {
            width: 24px; height: 24px; border: 3px solid rgba(217,119,6,0.2);
            border-top-color: var(--ow-orange); border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ÏÇ¨Ïö¥Îìú ÌÜ†Í∏Ä */
        .sound-toggle {
            position: fixed; top: 15px; right: 15px; z-index: 100;
            background: rgba(255,255,255,0.9); border: 1px solid #E2E8F0;
            padding: 8px 14px; border-radius: 20px; cursor: pointer;
            font-family: 'Orbitron', sans-serif; font-size: 0.75em; font-weight: 700;
            color: #0F172A; transition: all 0.3s;
            display: flex; align-items: center; gap: 6px;
            backdrop-filter: blur(12px);
            box-shadow: 0 2px 8px rgba(15,23,42,0.06);
        }
        .sound-toggle:hover { border-color: var(--ow-blue); }
        .sound-toggle.muted { opacity: 0.5; }

        .template-section {
            background: #F8FAFC; padding: 12px;
            border-radius: 8px; border: 1px solid #E2E8F0;
        }
        .template-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 8px; }
        .template-buttons { display: flex; gap: 6px; flex-wrap: wrap; }
        .template-btn {
            padding: 6px 12px; border: 2px solid var(--ow-blue); background: transparent;
            color: var(--ow-blue); border-radius: 6px; cursor: pointer; font-size: 0.8em; font-weight: 700;
        }
        .template-btn:hover, .template-btn.active { background: var(--ow-blue); color: white; }
        .template-actions { display: flex; gap: 6px; }
        .template-action-btn {
            padding: 6px 12px; border: none; border-radius: 6px;
            cursor: pointer; font-size: 0.8em; font-weight: 700;
        }
        .template-action-btn.save { background: linear-gradient(135deg, #059669, #047857); color: white; }
        .template-action-btn.rename { background: linear-gradient(135deg, var(--ow-orange), #B45309); color: white; }
        
        /* Î™®Îã¨ Í≥µÌÜµ */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15,23,42,0.5); z-index: 1000; align-items: center; justify-content: center;
            backdrop-filter: blur(8px);
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            border: 1px solid #E2E8F0; padding: 24px; border-radius: 14px;
            max-width: 350px; width: 90%;
            box-shadow: 0 20px 60px rgba(15,23,42,0.15);
        }
        .modal-title {
            font-family: 'Orbitron', sans-serif; font-size: 1.1em; font-weight: 700;
            margin-bottom: 15px; text-align: center; color: #0F172A;
        }
        .modal-input {
            width: 100%; background: #F8FAFC; border: 2px solid #E2E8F0;
            color: #0F172A; padding: 10px; border-radius: 8px;
            font-size: 1em; text-align: center; margin-bottom: 15px;
        }
        .modal-input:focus { outline: none; border-color: var(--ow-blue); }
        .modal-buttons { display: flex; gap: 10px; }
        .modal-btn {
            flex: 1; font-family: 'Orbitron', sans-serif; padding: 10px;
            border: none; border-radius: 8px; font-size: 0.85em; font-weight: 700; cursor: pointer;
        }
        .modal-btn.save { background: linear-gradient(135deg, #059669, #047857); color: white; }
        .modal-btn.cancel { background: #F1F5F9; color: #64748B; border: 1px solid #E2E8F0; }
        .role-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .role-option {
            padding: 15px; background: #F8FAFC; border: 2px solid #E2E8F0;
            border-radius: 10px; cursor: pointer; text-align: center; font-size: 1em; font-weight: 700;
            color: #475569; transition: all 0.3s;
        }
        .role-option:hover { background: rgba(37,99,235,0.06); border-color: var(--ow-blue); color: var(--ow-blue); }
        .role-option.selected { background: var(--ow-blue); border-color: var(--ow-blue); color: white; }
        
        /* Í≤ΩÎß§ Î™®Îã¨ */
        .auction-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15,23,42,0.6); z-index: 2000; align-items: center; justify-content: center;
            padding: 15px; backdrop-filter: blur(8px);
        }
        .auction-modal.active { display: flex; }
        .auction-content {
            background: white;
            border: 2px solid var(--ow-orange); border-radius: 14px;
            max-width: 750px; width: 100%; 
            box-shadow: 0 20px 60px rgba(217,119,6,0.15);
        }
        .auction-header {
            background: linear-gradient(135deg, var(--ow-orange), #B45309);
            padding: 10px 15px; border-radius: 12px 12px 0 0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .auction-title { font-family: 'Orbitron', sans-serif; font-size: 1.1em; font-weight: 900; color: white; }
        #auctionLeader1Name { 
            color: #fff; font-weight: 900; 
            text-shadow: 0 0 8px rgba(37,99,235,0.5);
        }
        #auctionLeader2Name { 
            color: #fff; font-weight: 900; 
            text-shadow: 0 0 8px rgba(217,119,6,0.5);
        }
        .auction-team-name { white-space: nowrap; }
        
        .auction-body { padding: 15px; }
        
        .auction-top-section { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        
        .timer-container { position: relative; width: 80px; height: 80px; flex-shrink: 0; }
        .timer-ring { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .timer-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
        .timer-ring-bg { fill: none; stroke: #E2E8F0; stroke-width: 6; }
        .timer-ring-progress {
            fill: none; stroke: var(--ow-orange); stroke-width: 6; stroke-linecap: round;
            stroke-dasharray: 314; stroke-dashoffset: 0; transition: stroke-dashoffset 0.1s linear;
        }
        .timer-ring-progress.warning { stroke: #DC2626; }
        .timer-display { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .timer-seconds { font-family: 'Orbitron', sans-serif; font-size: 1.8em; font-weight: 900; line-height: 1; color: #0F172A; }
        .timer-seconds.warning { color: #DC2626; animation: timerPulse 0.5s ease-in-out infinite; }
        .timer-label { font-size: 0.6em; color: #94A3B8; }
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .auction-current-player {
            flex: 1; display: flex; align-items: center; justify-content: space-between;
            background: linear-gradient(135deg, rgba(217,119,6,0.08), rgba(217,119,6,0.02));
            border: 2px solid var(--ow-orange); border-radius: 10px; padding: 10px 20px;
        }
        .auction-player-info-wrapper { display: flex; align-items: center; gap: 15px; }
        .auction-player-role-icon { font-size: 2.2em; }
        .auction-player-name { font-family: 'Orbitron', sans-serif; font-size: 1.4em; font-weight: 900; color: #0F172A; }
        .auction-player-stats { display: flex; gap: 8px; }
        .auction-player-tier, .auction-player-role {
            font-family: 'Orbitron', sans-serif; font-size: 0.8em;
            padding: 4px 10px; border-radius: 6px; font-weight: 700;
        }
        .auction-player-tier { background: #F1F5F9; color: #475569; }
        .auction-player-role { background: #E2E8F0; color: #334155; }
        
        .current-bid-display {
            background: #F8FAFC; border: 1px solid #E2E8F0;
            border-radius: 8px; padding: 8px; text-align: center; margin-bottom: 15px;
        }
        .current-bid-label { font-size: 0.75em; color: #94A3B8; margin-bottom: 2px; }
        .current-bid-value { font-family: 'Orbitron', sans-serif; font-size: 1.2em; font-weight: 900; }
        .current-bid-value.team-1 { color: var(--ow-blue); }
        .current-bid-value.team-2 { color: var(--ow-orange); }
        .current-bid-value.none { color: #CBD5E1; }
        
        .auction-teams-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .auction-team-box {
            background: #F8FAFC; border-radius: 10px; padding: 10px; text-align: center;
            border: 2px solid transparent; transition: all 0.3s;
        }
        .auction-team-box.team-1 { border-color: rgba(37,99,235,0.2); }
        .auction-team-box.team-2 { border-color: rgba(217,119,6,0.2); }
        .auction-team-box.leading.team-1 { background: rgba(37,99,235,0.06); border-color: var(--ow-blue); }
        .auction-team-box.leading.team-2 { background: rgba(217,119,6,0.06); border-color: var(--ow-orange); }
        
        .auction-team-header-row { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 5px; }
        .auction-team-name { font-family: 'Orbitron', sans-serif; font-size: 0.9em; font-weight: 700; }
        .team-1 .auction-team-name { color: var(--ow-blue); }
        .team-2 .auction-team-name { color: var(--ow-orange); }
        .auction-team-points { font-family: 'Orbitron', sans-serif; font-size: 1.2em; font-weight: 900; }
        .team-1 .auction-team-points { color: var(--ow-blue); }
        .team-2 .auction-team-points { color: var(--ow-orange); }
        
        .auction-bid-input {
            width: 100%; background: white; border: 2px solid #E2E8F0;
            color: #0F172A; padding: 6px; border-radius: 6px;
            font-family: 'Orbitron', sans-serif; font-size: 1em; text-align: center; margin-bottom: 6px;
        }
        .auction-bid-input:focus { outline: none; border-color: var(--ow-blue); }
        .quick-bid-row { display: flex; gap: 4px; margin-bottom: 6px; }
        .quick-bid-btn {
            flex: 1; background: #F1F5F9; border: 1px solid #E2E8F0;
            color: #475569; padding: 6px 2px; border-radius: 6px;
            font-size: 0.7em; font-weight: 700; cursor: pointer;
        }
        .quick-bid-btn:hover { background: #E2E8F0; color: #0F172A; }
        .auction-bid-btn {
            width: 100%; padding: 8px; border: none; border-radius: 6px;
            font-family: 'Orbitron', sans-serif; font-size: 0.85em; font-weight: 700; cursor: pointer;
        }
        .team-1 .auction-bid-btn { background: linear-gradient(135deg, var(--ow-blue), #0EA5E9); color: white; }
        .team-2 .auction-bid-btn { background: linear-gradient(135deg, var(--ow-orange), #B45309); color: white; }
        .auction-bid-btn:disabled { background: #E2E8F0; color: #94A3B8; cursor: not-allowed; }
        
        .bid-history {
            background: #F8FAFC; border: 1px solid #E2E8F0;
            border-radius: 8px; padding: 8px; margin-bottom: 10px; max-height: 60px; overflow-y: auto;
        }
        .bid-history-title { font-size: 0.7em; color: #94A3B8; margin-bottom: 4px; }
        .bid-history-list { display: flex; flex-direction: column; gap: 2px; }
        .bid-history-item { font-size: 0.75em; padding: 2px 6px; border-radius: 3px; }
        .bid-history-item.team-1 { background: rgba(37,99,235,0.08); border-left: 2px solid var(--ow-blue); color: var(--ow-blue); }
        .bid-history-item.team-2 { background: rgba(217,119,6,0.08); border-left: 2px solid var(--ow-orange); color: var(--ow-orange); }
        
        .remaining-players {
            background: #F8FAFC; border: 1px solid #E2E8F0;
            border-radius: 8px; padding: 8px; margin-bottom: 10px;
        }
        .remaining-title { font-size: 0.7em; color: #94A3B8; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .remaining-grid { display: flex; flex-wrap: wrap; gap: 4px; }
        .remaining-player {
            background: #F1F5F9; border: 1px solid #E2E8F0;
            border-radius: 4px; padding: 4px 8px; font-size: 0.75em; color: #475569;
        }
        .remaining-player.current {
            background: rgba(217,119,6,0.1);
            border-color: var(--ow-orange); color: var(--ow-orange); font-weight: 700;
        }
        .auction-controls { display: flex; gap: 8px; }
        .auction-control-btn {
            flex: 1; font-family: 'Orbitron', sans-serif; padding: 10px;
            border: none; border-radius: 8px; font-size: 0.8em; font-weight: 700; cursor: pointer;
        }
        .auction-pass-btn { background: linear-gradient(135deg, #7C3AED, #6D28D9); color: white; }
        .auction-next-btn { background: linear-gradient(135deg, #059669, #047857); color: white; }
        .auction-close-btn { background: linear-gradient(135deg, #DC2626, #B91C1C); color: white; }
        
        .special-effect {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-family: 'Orbitron', sans-serif; font-size: 2em; font-weight: 900;
            color: var(--ow-orange); text-shadow: 0 0 30px rgba(217,119,6,0.6);
            z-index: 3000; pointer-events: none; animation: specialPop 1.5s ease-out forwards;
        }
        @keyframes specialPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5) translateY(-50px); }
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .teams-grid { grid-template-columns: 1fr; gap: 20px; }
            .vs-divider { flex-direction: row; }
            .vs-text { font-size: 2em; }
            .action-buttons { flex-direction: column; }
            .btn { width: 100%; }
            .auction-teams-row { grid-template-columns: 1fr; }
            .auction-top-section { flex-direction: column; }
            .screenshot-preview-area.active { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="hex-background"></div>
    <div class="hex-pattern"></div>
    
    <div class="sound-toggle" id="soundToggle" onclick="toggleSound()">
        <span id="soundIcon">üîä</span> <span id="soundLabel">ON</span>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>Ï∞∏Ïä§ÏΩîÎìú ÌîÑÎ°úÍ∑∏Îû®</h1>
            <div class="header-subtitle">Ï∞∏Ïä§ÏΩîÎìú Í≤ΩÎß§ ÏãúÏä§ÌÖú Pro</div>
        </div>
        <div class="controls">
            <div class="action-buttons">
                <button class="btn btn-balanced" id="balancedBtn">Î∞∏Îü∞Ïä§ ÎûúÎç§</button>
                <button class="btn btn-spectator" id="spectatorRandomBtn">Í¥ÄÏ†ÑÏûê ÎûúÎç§</button>
                <button class="btn btn-auction" id="auctionBtn">Í≤ΩÎß§ÌïòÍ∏∞</button>
                <button class="btn btn-reset-spectator" id="resetToSpectatorBtn">Î™®Îëê Í¥ÄÏ†ÑÏûêÎ°ú ÎÇ¥Î¶¨Í∏∞</button>
                <button class="btn btn-add-all" id="addAllToSpectatorBtn">ÎåÄÍ∏∞Ïûê Ï†ÑÏõê Í¥ÄÏ†Ñ</button>
                <button class="btn btn-secondary" id="clearTeamsBtn">Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
            </div>
        </div>
        <div class="teams-container">
            <div class="teams-grid">
                <div class="team team-1">
                    <div class="team-header">
                        <span>1ÌåÄ</span>
                        <div class="team-stats">
                            <span class="team-score" id="team1Score">0Ï†ê</span>
                            <span class="team-points" id="team1Points">100P</span>
                        </div>
                    </div>
                    <div class="team-slots" id="team1"></div>
                </div>
                <div class="vs-divider">
                    <div class="vs-text">VS</div>
                    <div class="score-diff" id="scoreDiff">Ï†êÏàòÏ∞®: 0</div>
                </div>
                <div class="team team-2">
                    <div class="team-header">
                        <span>2ÌåÄ</span>
                        <div class="team-stats">
                            <span class="team-score" id="team2Score">0Ï†ê</span>
                            <span class="team-points" id="team2Points">100P</span>
                        </div>
                    </div>
                    <div class="team-slots" id="team2"></div>
                </div>
            </div>
            <div class="spectators">
                <div class="spectators-header">
                    <span>Í¥ÄÏ†ÑÏûê</span>
                    <span class="spectator-count" id="spectatorCount">0Î™Ö</span>
                </div>
                <div class="spectators-grid empty" id="spectatorsGrid"></div>
            </div>
        </div>
        <div class="player-list-container">
            <div class="player-input-section">
                <div class="section-title">Ï∞∏Í∞ÄÏûê Î™©Î°ù</div>
                <div class="saved-players" id="savedPlayers">
                    <span style="color:#94A3B8">Ï†ÄÏû•Îêú Ï∞∏Í∞ÄÏûê ÏóÜÏùå</span>
                </div>
                <div class="add-player-section">
                    <input type="text" class="player-name-input" id="newPlayerInput" placeholder="Ï∞∏Í∞ÄÏûê Ïù¥Î¶Ñ...">
                    <span class="tier-input-label">Ìã∞Ïñ¥:</span>
                    <input type="number" class="tier-input" id="newTierInput" value="3" min="1">
                    <button class="add-player-btn" id="addPlayerBtn">Ï∂îÍ∞Ä</button>
                </div>
                <div class="info-message">[F1]: ÎÇôÏ∞∞ / [F2]: Ïú†Ï∞∞ / [Tab]: ÏûÖÎ†•Ï∞Ω Ï†ÑÌôò / Ïä§ÌÅ¨Î¶∞ÏÉ∑ÏùÑ ÏïÑÎûòÏóê Î∂ôÏó¨ÎÑ£Í∏∞(Ctrl+V)ÌïòÎ©¥ ÏûêÎèô Ïù∏Ïãù!</div>
                
                <div class="screenshot-section" id="screenshotSection">
                    <div class="screenshot-header">
                        <div class="screenshot-title">Ïä§ÌÅ¨Î¶∞ÏÉ∑ÏúºÎ°ú Ï∞∏Í∞ÄÏûê Ï∂îÍ∞Ä</div>
                        <div class="screenshot-desc">Ïù¥ÎØ∏ÏßÄÎ•º ÎìúÎûòÍ∑∏ÌïòÍ±∞ÎÇò, ÌÅ¥Î¶≠ÌïòÏó¨ ÏóÖÎ°úÎìúÌïòÍ±∞ÎÇò, Ctrl+VÎ°ú Î∂ôÏó¨ÎÑ£Í∏∞</div>
                    </div>
                    <div class="screenshot-upload-area" id="screenshotUploadArea">
                        <div class="upload-icon">üìã</div>
                        <div class="upload-text"><strong>ÌÅ¥Î¶≠</strong> ÎòêÎäî <strong>ÎìúÎûòÍ∑∏</strong> ÎòêÎäî <strong>Ctrl+V</strong></div>
                    </div>
                    <input type="file" id="screenshotFileInput" accept="image/*">
                    <div class="screenshot-loading" id="screenshotLoading">
                        <div class="spinner"></div>
                        <span>Ïù¥ÎØ∏ÏßÄÏóêÏÑú Ïù¥Î¶ÑÏùÑ Ï∂îÏ∂úÌïòÎäî Ï§ë...</span>
                    </div>
                    <div class="screenshot-preview-area" id="screenshotPreview">
                        <img class="screenshot-preview" id="screenshotImg" src="">
                        <div class="screenshot-names-area">
                            <div style="font-size:0.8em; color:#94A3B8; margin-bottom:4px;">Ïù∏ÏãùÎêú Ïù¥Î¶Ñ (Ï§ÑÎ∞îÍøàÏúºÎ°ú Íµ¨Î∂Ñ, ÏàòÏ†ï Í∞ÄÎä•):</div>
                            <textarea class="screenshot-names-textarea" id="screenshotNames" placeholder="Ïù¥Î¶ÑÏùÑ Ìïú Ï§ÑÏóê ÌïòÎÇòÏî© ÏûÖÎ†•..."></textarea>
                            <div class="screenshot-actions">
                                <button class="screenshot-btn apply" id="screenshotApplyBtn">Ï∞∏Í∞ÄÏûêÏóê Ï∂îÍ∞Ä</button>
                                <button class="screenshot-btn cancel" id="screenshotCancelBtn">Ï∑®ÏÜå</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="template-section">
                <div class="template-header">
                    <div class="section-title">ÌÖúÌîåÎ¶ø</div>
                    <div class="template-actions">
                        <button class="template-action-btn save" id="saveTemplateBtn">Ï†ÄÏû•</button>
                        <button class="template-action-btn rename" id="renameTemplateBtn">Ïù¥Î¶ÑÎ≥ÄÍ≤Ω</button>
                    </div>
                </div>
                <div class="template-buttons" id="templateButtons"></div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="tierModal">
        <div class="modal-content">
            <div class="modal-title">Ìã∞Ïñ¥ ÏàòÏ†ï</div>
            <input type="number" class="modal-input" id="tierModalInput" min="1">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="tierModalCancel">Ï∑®ÏÜå</button>
                <button class="modal-btn save" id="tierModalSave">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>
    <div class="modal" id="roleModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-title" id="roleModalTitle">Ïó≠Ìï† ÏÑ†ÌÉù</div>
            <div class="role-selector">
                <div class="role-option" data-role="ÌÉ±Ïª§">üõ°Ô∏è<br>ÌÉ±Ïª§</div>
                <div class="role-option" data-role="ÎîúÎü¨">‚öîÔ∏è<br>ÎîúÎü¨</div>
                <div class="role-option" data-role="ÌûêÎü¨">‚ù§Ô∏è<br>ÌûêÎü¨</div>
                <div class="role-option" data-role="ÎûúÎç§">üé≤<br>ÎûúÎç§</div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="roleModalCancel">Ï∑®ÏÜå</button>
                <button class="modal-btn save" id="roleModalSave">ÌôïÏù∏</button>
            </div>
        </div>
    </div>
    <div class="modal" id="templateNameModal">
        <div class="modal-content">
            <div class="modal-title" id="templateNameModalTitle">ÌÖúÌîåÎ¶ø Ïù¥Î¶Ñ</div>
            <input type="text" class="modal-input" id="templateNameInput" placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•...">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="templateNameCancel">Ï∑®ÏÜå</button>
                <button class="modal-btn save" id="templateNameSave">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>
    <div class="auction-modal" id="auctionModal">
        <div class="auction-content">
            <div class="auction-header">
                <div class="auction-title">Í≤ΩÎß§ ÏßÑÌñâÏ§ë</div>
            </div>
            <div class="auction-body">
                <div class="auction-top-section">
                    <div class="timer-container">
                        <div class="timer-ring">
                            <svg viewBox="0 0 120 120">
                                <circle class="timer-ring-bg" cx="60" cy="60" r="50"></circle>
                                <circle class="timer-ring-progress" id="timerProgress" cx="60" cy="60" r="50"></circle>
                            </svg>
                        </div>
                        <div class="timer-display">
                            <div class="timer-seconds" id="timerSeconds">6</div>
                            <div class="timer-label">Ï¥à</div>
                        </div>
                    </div>
                    <div class="auction-current-player">
                        <div class="auction-player-info-wrapper">
                            <div class="auction-player-role-icon" id="auctionPlayerIcon">üé≤</div>
                            <div class="auction-player-name" id="auctionPlayerName">ÌîåÎ†àÏù¥Ïñ¥</div>
                        </div>
                        <div class="auction-player-stats">
                            <div class="auction-player-tier" id="auctionPlayerTier">3Ï†ê</div>
                            <div class="auction-player-role" id="auctionPlayerRole">ÎûúÎç§</div>
                        </div>
                    </div>
                </div>

                <div class="current-bid-display">
                    <div class="current-bid-label">ÌòÑÏû¨ ÏûÖÏ∞∞</div>
                    <div class="current-bid-value none" id="currentBidValue">ÏûÖÏ∞∞ ÏóÜÏùå</div>
                </div>
                <div class="auction-teams-row">
                    <div class="auction-team-box team-1" id="auctionTeamBox1">
                        <div class="auction-team-header-row">
                            <div class="auction-team-name">1ÌåÄ <span id="auctionLeader1Wrap">(<span id="auctionLeader1Name"></span>)</span></div>
                            <div class="auction-team-points" id="auctionTeam1Points">100</div>
                        </div>
                        <input type="number" class="auction-bid-input" id="team1BidInput" min="0" placeholder="ÏûÖÏ∞∞Í∞Ä">
                        <div class="quick-bid-row">
                            <button class="quick-bid-btn" onclick="quickBid(1,1)">+1</button>
                            <button class="quick-bid-btn" onclick="quickBid(1,5)">+5</button>
                            <button class="quick-bid-btn" onclick="quickBid(1,10)">+10</button>
                            <button class="quick-bid-btn" onclick="allInBid(1)">Ïò¨Ïù∏</button>
                        </div>
                        <button class="auction-bid-btn" id="team1BidBtn">ÏûÖÏ∞∞</button>
                    </div>
                    <div class="auction-team-box team-2" id="auctionTeamBox2">
                        <div class="auction-team-header-row">
                            <div class="auction-team-name">2ÌåÄ <span id="auctionLeader2Wrap">(<span id="auctionLeader2Name"></span>)</span></div>
                            <div class="auction-team-points" id="auctionTeam2Points">100</div>
                        </div>
                        <input type="number" class="auction-bid-input" id="team2BidInput" min="0" placeholder="ÏûÖÏ∞∞Í∞Ä">
                        <div class="quick-bid-row">
                            <button class="quick-bid-btn" onclick="quickBid(2,1)">+1</button>
                            <button class="quick-bid-btn" onclick="quickBid(2,5)">+5</button>
                            <button class="quick-bid-btn" onclick="quickBid(2,10)">+10</button>
                            <button class="quick-bid-btn" onclick="allInBid(2)">Ïò¨Ïù∏</button>
                        </div>
                        <button class="auction-bid-btn" id="team2BidBtn">ÏûÖÏ∞∞</button>
                    </div>
                </div>
                <div class="bid-history">
                    <div class="bid-history-title">ÏûÖÏ∞∞ Í∏∞Î°ù</div>
                    <div class="bid-history-list" id="bidHistoryList"></div>
                </div>
                <div class="remaining-players">
                    <div class="remaining-title">
                        <span>ÎåÄÍ∏∞ ÏÑ†Ïàò</span>
                        <span id="remainingCount">0Î™Ö</span>
                    </div>
                    <div class="remaining-grid" id="remainingGrid"></div>
                </div>
                <div class="auction-controls">
                    <button class="auction-control-btn auction-pass-btn" id="auctionPassBtn">Ïú†Ï∞∞ (F2)</button>
                    <button class="auction-control-btn auction-next-btn" id="auctionNextBtn">ÎÇôÏ∞∞ (F1)</button>
                    <button class="auction-control-btn auction-close-btn" id="auctionCloseBtn">Îã´Í∏∞</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let soundEnabled = true;
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;
        let bgmPlaying = false;
        let bgmTimeout = null;
        let bgmStopped = false;

        function getAudioCtx() {
            if (!audioCtx) audioCtx = new AudioCtx();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            return audioCtx;
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundIcon').textContent = soundEnabled ? 'üîä' : 'üîá';
            document.getElementById('soundLabel').textContent = soundEnabled ? 'ON' : 'OFF';
            document.getElementById('soundToggle').classList.toggle('muted', !soundEnabled);
            if (!soundEnabled) { stopBGM(); speechSynthesis.cancel(); }
        }

        function speak(text, rate = 1.0, pitch = 0.7) {
            if (!soundEnabled) return;
            try {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'ko-KR'; u.rate = rate; u.pitch = pitch; u.volume = 1.0;
                const voices = speechSynthesis.getVoices();
                const maleKo = voices.find(v => v.lang.startsWith('ko') && (v.name.toLowerCase().includes('male') || v.name.includes('ÎÇ®')));
                const koVoice = maleKo || voices.find(v => v.lang.startsWith('ko'));
                if (koVoice) u.voice = koVoice;
                speechSynthesis.cancel(); speechSynthesis.speak(u);
            } catch(e) {}
        }
        function shout(text) { speak(text, 1.1, 0.55); }

        function playKick(volume = 0.3) {
            if (!soundEnabled) return;
            try {
                const ctx = getAudioCtx(); const osc = ctx.createOscillator(); const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(40, ctx.currentTime + 0.12);
                gain.gain.setValueAtTime(volume, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
                osc.connect(gain); gain.connect(ctx.destination);
                osc.start(ctx.currentTime); osc.stop(ctx.currentTime + 0.35);
            } catch(e) {}
        }
        function playSubBass(freq = 55, duration = 0.25, volume = 0.2) {
            if (!soundEnabled) return;
            try {
                const ctx = getAudioCtx(); const osc = ctx.createOscillator(); const gain = ctx.createGain();
                osc.type = 'sine'; osc.frequency.setValueAtTime(freq, ctx.currentTime);
                gain.gain.setValueAtTime(volume, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
                osc.connect(gain); gain.connect(ctx.destination);
                osc.start(ctx.currentTime); osc.stop(ctx.currentTime + duration + 0.05);
            } catch(e) {}
        }
        function playTone(freq, duration, volume = 0.1) {
            if (!soundEnabled) return;
            try {
                const ctx = getAudioCtx(); const osc = ctx.createOscillator(); const gain = ctx.createGain();
                osc.type = 'sine'; osc.frequency.setValueAtTime(freq, ctx.currentTime);
                gain.gain.setValueAtTime(volume, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
                osc.connect(gain); gain.connect(ctx.destination);
                osc.start(ctx.currentTime); osc.stop(ctx.currentTime + duration + 0.05);
            } catch(e) {}
        }
        function playChord(freqs, duration, volume = 0.06) { freqs.forEach(f => playTone(f, duration, volume)); }

        let bgmVolume = 0.2, bgmBeat = 0;
        function startBGM() {
            if (!soundEnabled || bgmPlaying) return;
            bgmPlaying = true; bgmStopped = false; bgmVolume = 0.15; bgmBeat = 0; bgmLoop();
        }
        function bgmLoop() {
            if (bgmStopped || !bgmPlaying) return;
            const pattern = bgmBeat % 8; const v = bgmVolume;
            if (pattern === 0) playKick(v);
            else if (pattern === 2) playSubBass(65, 0.2, v * 0.7);
            else if (pattern === 4) playKick(v * 0.85);
            else if (pattern === 5) playKick(v * 0.6);
            else if (pattern === 6) playSubBass(55, 0.2, v * 0.7);
            bgmBeat++; bgmTimeout = setTimeout(() => bgmLoop(), 217);
        }
        function stopBGM() { bgmStopped = true; bgmPlaying = false; if (bgmTimeout) { clearTimeout(bgmTimeout); bgmTimeout = null; } }
        function setBGMTension(level) { bgmVolume = 0.12 + level * 0.15; }

        function playBidSound() { playKick(0.25); setTimeout(() => playSubBass(80, 0.15, 0.15), 60); }
        function playSuccessSound() { playKick(0.35); setTimeout(()=>playSubBass(55,0.3,0.2),100); setTimeout(()=>playKick(0.3),300); setTimeout(()=>playSubBass(65,0.3,0.2),400); setTimeout(()=>{playKick(0.35);playSubBass(82,0.5,0.25);},600); }
        function playPassSound() { playSubBass(80,0.2,0.12); setTimeout(()=>playSubBass(60,0.2,0.1),150); setTimeout(()=>playSubBass(40,0.3,0.08),300); }
        function playTimerWarningSound() { playKick(0.25); }
        function playTimerEndSound() { playSubBass(80,0.5,0.2); setTimeout(()=>playSubBass(50,0.5,0.15),250); }
        function playAuctionStartSound() { for(let i=0;i<4;i++) setTimeout(()=>playKick(0.25+i*0.03),i*150); setTimeout(()=>playSubBass(65,0.4,0.25),650); setTimeout(()=>{playKick(0.35);playSubBass(82,0.5,0.25);},900); }
        function playAllInSound() { playKick(0.35); setTimeout(()=>playKick(0.35),80); setTimeout(()=>playKick(0.35),160); setTimeout(()=>playSubBass(40,0.6,0.3),280); }
        function playCompleteSound() { for(let i=0;i<6;i++) setTimeout(()=>playKick(0.2+i*0.02),i*120); setTimeout(()=>{playKick(0.35);playSubBass(55,0.6,0.25);},750); setTimeout(()=>{playKick(0.35);playSubBass(82,0.8,0.25);},1100); }
        function playClickSound() { playKick(0.08); }
        function playNewPlayerSound() { for(let i=0;i<6;i++) setTimeout(()=>playKick(0.1+i*0.04),i*55); setTimeout(()=>{playKick(0.35);playSubBass(65,0.3,0.2);},380); }

        let savedPlayers = [], draggedElement = null, sourceContainer = null, nextPlayerId = 1;
        let editingPlayerId = null, editingSpectatorId = null, editingTeamPlayerId = null, selectedRole = null;
        let team1Points = 100, team2Points = 100, auctionPlayers = [], currentAuctionIndex = 0;
        let currentBid = { team: null, amount: 0 }, bidHistory = [];
        let auctionTimer = null, auctionTimeLeft = 6;
        const AUCTION_TIME = 6, MAX_TEMPLATES = 5;
        let templates = [], currentTemplateIndex = 0;
        const ROLE_ICONS = {'ÌÉ±Ïª§':'üõ°Ô∏è','ÎîúÎü¨':'‚öîÔ∏è','ÌûêÎü¨':'‚ù§Ô∏è','ÎûúÎç§':'üé≤'};
        const ROLE_NAMES = {'ÌÉ±Ïª§':'ÌÉ±Ïª§','ÎîúÎü¨':'ÎîúÎü¨','ÌûêÎü¨':'ÌûêÎü¨','ÎûúÎç§':'ÎûúÎç§'};
        const STORAGE_KEY = 'teamBuilder_kr_v3';
        let roleEditSource = null; 

        function init() { loadTemplates(); updateTemplateButtons(); loadCurrentTemplate(); updateTeamSlots(); updateSavedPlayersUI(); setupEventListeners(); setupSpectatorsDragDrop(); updateTeamPoints(); setupScreenshotFeature(); }
        function loadTemplates() { try { templates = JSON.parse(localStorage.getItem(STORAGE_KEY+'_templates')) || []; } catch(e) { templates = []; } while(templates.length < MAX_TEMPLATES) templates.push({name:`ÌÖúÌîåÎ¶ø ${templates.length+1}`,players:[],nextId:1}); currentTemplateIndex = parseInt(localStorage.getItem(STORAGE_KEY+'_current')) || 0; }
        function saveTemplates() { localStorage.setItem(STORAGE_KEY+'_templates', JSON.stringify(templates)); localStorage.setItem(STORAGE_KEY+'_current', currentTemplateIndex.toString()); }
        function loadCurrentTemplate() { const t = templates[currentTemplateIndex]; savedPlayers = t.players || []; nextPlayerId = t.nextId || 1; }
        function saveCurrentTemplate() { templates[currentTemplateIndex].players = savedPlayers; templates[currentTemplateIndex].nextId = nextPlayerId; saveTemplates(); }
        function switchTemplate(i) { saveCurrentTemplate(); currentTemplateIndex = i; loadCurrentTemplate(); updateTemplateButtons(); updateSavedPlayersUI(); clearAll(); saveTemplates(); }
        function updateTemplateButtons() { const c = document.getElementById('templateButtons'); c.innerHTML = ''; templates.forEach((t,i) => { const b = document.createElement('button'); b.className = 'template-btn' + (i===currentTemplateIndex?' active':''); b.textContent = t.name; b.onclick = () => switchTemplate(i); c.appendChild(b); }); }
        function openTemplateNameModal() { document.getElementById('templateNameInput').value = templates[currentTemplateIndex].name; document.getElementById('templateNameModal').classList.add('active'); document.getElementById('templateNameInput').focus(); }
        function saveTemplateName() { const n = document.getElementById('templateNameInput').value.trim(); if(!n) return alert('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî!'); templates[currentTemplateIndex].name = n; saveTemplates(); updateTemplateButtons(); document.getElementById('templateNameModal').classList.remove('active'); }
        function updateTeamPoints() { document.getElementById('team1Points').textContent = team1Points+'P'; document.getElementById('team2Points').textContent = team2Points+'P'; }
        function getTierClass(t) { if(t<=1) return 'tier-bronze'; if(t<=2) return 'tier-silver'; if(t<=3) return 'tier-gold'; if(t<=4) return 'tier-platinum'; return 'tier-diamond'; }
        function getTeamPlayerNames() { const s = new Set(); document.querySelectorAll('.team-slot .player-card').forEach(c => s.add(JSON.parse(c.dataset.player).name)); return s; }
        function getSpectatorPlayerNames() { const s = new Set(); document.querySelectorAll('#spectatorsGrid .spectator-card').forEach(c => s.add(JSON.parse(c.dataset.player).name)); return s; }
        function getSpectatorPlayers() { const p = []; document.querySelectorAll('#spectatorsGrid .spectator-card').forEach(c => p.push(JSON.parse(c.dataset.player))); return p; }
        function calculateTeamSize() { const t1 = document.querySelectorAll('#team1 .player-card').length; const t2 = document.querySelectorAll('#team2 .player-card').length; const sc = document.querySelectorAll('#spectatorsGrid .spectator-card').length; return Math.max(5, Math.ceil((t1+t2+sc)/2)); }
        function getRoleCounts(p) { const c = {'ÌÉ±Ïª§':0,'ÎîúÎü¨':0,'ÌûêÎü¨':0,'ÎûúÎç§':0}; p.forEach(x => c[x.role]++); return c; }

        function resetAllToSpectators() { const tp = []; document.querySelectorAll('.team-slot .player-card').forEach(c => tp.push(JSON.parse(c.dataset.player))); if(tp.length===0) return alert('ÌåÄÏóê Î∞∞ÏπòÎêú Ïù∏ÏõêÏù¥ ÏóÜÏäµÎãàÎã§!'); document.querySelectorAll('.team-slot').forEach(s => { s.innerHTML=''; s.classList.add('empty'); }); tp.forEach(p => addToSpectators(p)); updateSpectatorCount(); updateTeamScores(); updateSavedPlayersUI(); updateTeamSlots(); }
        function addAllWaitlistToSpectator() { let count=0; const existing = new Set([...getTeamPlayerNames(),...getSpectatorPlayerNames()]); savedPlayers.forEach(p => { if(!existing.has(p.name)){ addToSpectators(p); count++; } }); if(count>0){ updateSpectatorCount(); updateSavedPlayersUI(); updateTeamSlots(); } else { alert('Ï∂îÍ∞ÄÌï† ÎåÄÍ∏∞ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.'); } }

        function startAuctionTimer() { stopAuctionTimer(); auctionTimeLeft = AUCTION_TIME; updateTimerDisplay(); auctionTimer = setInterval(() => { auctionTimeLeft--; updateTimerDisplay(); const tension = 1-(auctionTimeLeft/AUCTION_TIME); setBGMTension(tension); if(auctionTimeLeft<=3&&auctionTimeLeft>0){playTimerWarningSound();if(auctionTimeLeft<=3)speak(`${auctionTimeLeft}!`,1.5,0.4);} if(auctionTimeLeft<=0){stopAuctionTimer();playTimerEndSound();} }, 1000); }
        function stopAuctionTimer() { if(auctionTimer){clearInterval(auctionTimer);auctionTimer=null;} }
        function resetAuctionTimer() { startAuctionTimer(); }
        function updateTimerDisplay() { const ts=document.getElementById('timerSeconds'),tp=document.getElementById('timerProgress'); ts.textContent=auctionTimeLeft; const circ=2*Math.PI*50,off=circ*(1-auctionTimeLeft/AUCTION_TIME); tp.style.strokeDashoffset=off; if(auctionTimeLeft<=3){ts.classList.add('warning');tp.classList.add('warning');}else{ts.classList.remove('warning');tp.classList.remove('warning');} }
        function showSpecialEffect(t) { const e=document.createElement('div');e.className='special-effect';e.textContent=t;document.body.appendChild(e);setTimeout(()=>e.remove(),1500); }

        function setupSpectatorsDragDrop() { const g=document.getElementById('spectatorsGrid'); g.addEventListener('dragover',e=>{e.preventDefault();e.dataTransfer.dropEffect='move';}); g.addEventListener('dragenter',e=>e.currentTarget.classList.add('drag-over')); g.addEventListener('dragleave',e=>{if(e.target===e.currentTarget)e.currentTarget.classList.remove('drag-over');}); g.addEventListener('drop',e=>{e.stopPropagation();e.preventDefault();g.classList.remove('drag-over');if(!draggedElement||!sourceContainer)return;const p=JSON.parse(draggedElement.dataset.player);if(sourceContainer.classList.contains('team-slot')){sourceContainer.innerHTML='';sourceContainer.classList.add('empty');addToSpectators(p);updateTeamScores();updateSpectatorCount();updateSavedPlayersUI();updateTeamSlots();}}); }

        function addToSpectators(p) { const g=document.getElementById('spectatorsGrid'); if(getSpectatorPlayerNames().has(p.name))return; g.classList.remove('empty'); const cs=getSpectatorPlayers(); cs.push(p); cs.sort((a,b)=>a.name.localeCompare(b.name,'ko')); g.innerHTML=''; cs.forEach(sp=>g.appendChild(createSpectatorCard(sp))); }
        function createSpectatorCard(p) { const c=document.createElement('div');c.className='spectator-card';c.innerHTML=`<button class="remove-spectator-btn">‚úï</button><div class="spectator-name">${p.name}</div><div class="spectator-meta"><span class="spectator-tier">${p.tier}Ï†ê</span><span class="spectator-role">${ROLE_ICONS[p.role]} ${ROLE_NAMES[p.role]}</span></div>`;c.draggable=true;c.dataset.player=JSON.stringify(p);c.addEventListener('dragstart',handleDragStart);c.addEventListener('dragend',handleDragEnd);c.querySelector('.remove-spectator-btn').onclick=e=>{e.stopPropagation();removeFromSpectators(p);};c.querySelector('.spectator-role').onclick=e=>{e.stopPropagation();openRoleModal(p,'spectator');};c.querySelector('.spectator-tier').style.cursor='pointer';c.querySelector('.spectator-tier').onclick=e=>{e.stopPropagation();openTierModal(p);};return c; }
        function openRoleModal(p,source) { roleEditSource=source;if(source==='spectator')editingSpectatorId=p.id;else editingTeamPlayerId=p.id;selectedRole=p.role;document.getElementById('roleModalTitle').textContent=p.name+' - Ïó≠Ìï† ÏÑ†ÌÉù';document.querySelectorAll('.role-option').forEach(o=>{o.classList.toggle('selected',o.dataset.role===p.role);});document.getElementById('roleModal').classList.add('active'); }
        function saveRoleChange() { if(!selectedRole)return alert('Ïó≠Ìï†ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!');if(roleEditSource==='spectator'){document.querySelectorAll('#spectatorsGrid .spectator-card').forEach(c=>{const p=JSON.parse(c.dataset.player);if(p.id===editingSpectatorId){p.role=selectedRole;c.dataset.player=JSON.stringify(p);c.querySelector('.spectator-role').innerHTML=ROLE_ICONS[p.role]+' '+ROLE_NAMES[p.role];}});}else{document.querySelectorAll('.team-slot .player-card').forEach(c=>{const p=JSON.parse(c.dataset.player);if(p.id===editingTeamPlayerId){p.role=selectedRole;c.dataset.player=JSON.stringify(p);c.querySelector('.player-role-icon').textContent=ROLE_ICONS[p.role];c.querySelector('.role-badge').textContent=ROLE_NAMES[p.role];}});}document.getElementById('roleModal').classList.remove('active');editingSpectatorId=null;editingTeamPlayerId=null;selectedRole=null;roleEditSource=null; }
        function removeFromSpectators(p) { document.querySelectorAll('#spectatorsGrid .spectator-card').forEach(c=>{if(JSON.parse(c.dataset.player).id===p.id)c.remove();});updateSpectatorCount();updateSavedPlayersUI();updateTeamSlots(); }
        function updateSpectatorCount() { const g=document.getElementById('spectatorsGrid');const n=g.querySelectorAll('.spectator-card').length;document.getElementById('spectatorCount').textContent=n+'Î™Ö';g.classList.toggle('empty',n===0); }

        function setupEventListeners() {
            document.getElementById('addPlayerBtn').onclick=addPlayer;document.getElementById('newPlayerInput').onkeypress=e=>{if(e.key==='Enter')addPlayer();};document.getElementById('newTierInput').onkeypress=e=>{if(e.key==='Enter')addPlayer();};
            document.getElementById('balancedBtn').onclick=balancedRandomAssign;document.getElementById('spectatorRandomBtn').onclick=spectatorRandomAssign;document.getElementById('auctionBtn').onclick=startAuction;document.getElementById('resetToSpectatorBtn').onclick=resetAllToSpectators;document.getElementById('addAllToSpectatorBtn').onclick=addAllWaitlistToSpectator;document.getElementById('clearTeamsBtn').onclick=clearAll;
            document.getElementById('team1BidBtn').onclick=()=>placeBid(1);document.getElementById('team2BidBtn').onclick=()=>placeBid(2);document.getElementById('auctionPassBtn').onclick=passAuction;document.getElementById('auctionNextBtn').onclick=nextAuctionPlayer;document.getElementById('auctionCloseBtn').onclick=closeAuction;
            document.getElementById('team1BidInput').onkeypress=e=>{if(e.key==='Enter')placeBid(1);};document.getElementById('team2BidInput').onkeypress=e=>{if(e.key==='Enter')placeBid(2);};
            document.getElementById('tierModalCancel').onclick=()=>{document.getElementById('tierModal').classList.remove('active');};document.getElementById('tierModalSave').onclick=saveTierChange;document.getElementById('tierModalInput').onkeypress=e=>{if(e.key==='Enter')saveTierChange();};
            document.querySelectorAll('.role-option').forEach(o=>{o.onclick=function(){document.querySelectorAll('.role-option').forEach(x=>x.classList.remove('selected'));this.classList.add('selected');selectedRole=this.dataset.role;};});
            document.getElementById('roleModalCancel').onclick=()=>{document.getElementById('roleModal').classList.remove('active');};document.getElementById('roleModalSave').onclick=saveRoleChange;
            document.getElementById('saveTemplateBtn').onclick=()=>{saveCurrentTemplate();playClickSound();alert('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');};document.getElementById('renameTemplateBtn').onclick=openTemplateNameModal;
            document.getElementById('templateNameCancel').onclick=()=>{document.getElementById('templateNameModal').classList.remove('active');};document.getElementById('templateNameSave').onclick=saveTemplateName;document.getElementById('templateNameInput').onkeypress=e=>{if(e.key==='Enter')saveTemplateName();};
            const handleAuctionTab=(e,targetId)=>{if(e.key==='Tab'){e.preventDefault();const target=document.getElementById(targetId);target.focus();target.select();}};
            document.getElementById('team1BidInput').addEventListener('keydown',e=>handleAuctionTab(e,'team2BidInput'));document.getElementById('team2BidInput').addEventListener('keydown',e=>handleAuctionTab(e,'team1BidInput'));
            document.addEventListener('keydown',e=>{if(document.getElementById('auctionModal').classList.contains('active')){if(e.key==='F1'){e.preventDefault();nextAuctionPlayer();}if(e.key==='F2'){e.preventDefault();passAuction();}}});
        }

        function addPlayer() { const name=document.getElementById('newPlayerInput').value.trim();const tier=parseInt(document.getElementById('newTierInput').value)||3;if(!name)return alert('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî!');savedPlayers.push({id:nextPlayerId++,name,tier,role:'ÎûúÎç§'});saveCurrentTemplate();document.getElementById('newPlayerInput').value='';document.getElementById('newTierInput').value='3';updateSavedPlayersUI();playClickSound(); }
        function removePlayer(id) { const p=savedPlayers.find(x=>x.id===id);if(!p||!confirm('"'+p.name+'" ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?'))return;savedPlayers=savedPlayers.filter(x=>x.id!==id);document.querySelectorAll('.spectator-card').forEach(c=>{if(JSON.parse(c.dataset.player).id===id)c.remove();});document.querySelectorAll('.team-slot').forEach(s=>{const c=s.querySelector('.player-card');if(c&&JSON.parse(c.dataset.player).id===id){s.innerHTML='';s.classList.add('empty');}});saveCurrentTemplate();updateSavedPlayersUI();updateSpectatorCount();updateTeamScores();updateTeamSlots(); }
        function openTierModal(p) { editingPlayerId=p.id;document.getElementById('tierModalInput').value=p.tier;document.getElementById('tierModal').classList.add('active');document.getElementById('tierModalInput').focus(); }
        function saveTierChange() { const t=parseInt(document.getElementById('tierModalInput').value);if(isNaN(t)||t<1)return alert('Ìã∞Ïñ¥Îäî 1 Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§!');const p=savedPlayers.find(x=>x.id===editingPlayerId);if(p){p.tier=t;saveCurrentTemplate();updatePlayerCardsEverywhere(p);updateSavedPlayersUI();updateTeamScores();}document.getElementById('tierModal').classList.remove('active'); }
        function updatePlayerCardsEverywhere(p) { document.querySelectorAll('.spectator-card').forEach(c=>{const cp=JSON.parse(c.dataset.player);if(cp.id===p.id){cp.tier=p.tier;c.dataset.player=JSON.stringify(cp);c.querySelector('.spectator-tier').textContent=p.tier+'Ï†ê';}});document.querySelectorAll('.player-card').forEach(c=>{const cp=JSON.parse(c.dataset.player);if(cp.id===p.id){cp.tier=p.tier;c.dataset.player=JSON.stringify(cp);const tb=c.querySelector('.tier-badge');tb.textContent=p.tier+'Ï†ê';tb.className='tier-badge '+getTierClass(p.tier);}}); }
        function selectPlayer(p) { if(getTeamPlayerNames().has(p.name))return alert(p.name+'ÏùÄ(Îäî) Ïù¥ÎØ∏ ÌåÄÏóê ÏûàÏäµÎãàÎã§!');if(getSpectatorPlayerNames().has(p.name))return alert(p.name+'ÏùÄ(Îäî) Ïù¥ÎØ∏ Í¥ÄÏ†ÑÏûêÏûÖÎãàÎã§!');addToSpectators(p);updateSpectatorCount();updateSavedPlayersUI();updateTeamSlots();playClickSound(); }
        function updateSavedPlayersUI() { const c=document.getElementById('savedPlayers');c.innerHTML='';if(savedPlayers.length===0){c.innerHTML='<span style="color:#94A3B8">Ï†ÄÏû•Îêú Ï∞∏Í∞ÄÏûê ÏóÜÏùå</span>';return;}const teamN=getTeamPlayerNames(),specN=getSpectatorPlayerNames();[...savedPlayers].sort((a,b)=>a.name.localeCompare(b.name,'ko')).forEach(p=>{const t=document.createElement('div');t.className='saved-player-tag';if(teamN.has(p.name))t.classList.add('in-team');else if(specN.has(p.name))t.classList.add('in-spectator');else{t.classList.add('selectable');t.onclick=()=>selectPlayer(p);}t.innerHTML=`<span>${p.name}</span><span class="tier-badge-small">${p.tier}</span><button class="remove-btn">‚úï</button>`;t.querySelector('.tier-badge-small').onclick=e=>{e.stopPropagation();openTierModal(p);};t.querySelector('.remove-btn').onclick=e=>{e.stopPropagation();removePlayer(p.id);};c.appendChild(t);}); }

        function updateTeamSlots() { const size=calculateTeamSize();const t1=document.getElementById('team1'),t2=document.getElementById('team2');const p1=[],p2=[];t1.querySelectorAll('.player-card').forEach(c=>p1.push(JSON.parse(c.dataset.player)));t2.querySelectorAll('.player-card').forEach(c=>p2.push(JSON.parse(c.dataset.player)));t1.innerHTML='';t2.innerHTML='';for(let i=0;i<size;i++){const s1=createSlot('team1',i),s2=createSlot('team2',i);if(i<p1.length){s1.innerHTML='';s1.classList.remove('empty');s1.appendChild(createPlayerCard(p1[i],i===0));}if(i<p2.length){s2.innerHTML='';s2.classList.remove('empty');s2.appendChild(createPlayerCard(p2[i],i===0));}t1.appendChild(s1);t2.appendChild(s2);}updateTeamScores(); }
        function createSlot(tid,idx) { const s=document.createElement('div');s.className='team-slot empty';s.dataset.team=tid;s.dataset.index=idx;s.addEventListener('dragover',e=>{e.preventDefault();e.dataTransfer.dropEffect='move';});s.addEventListener('dragenter',e=>e.currentTarget.classList.add('drag-over'));s.addEventListener('dragleave',e=>e.currentTarget.classList.remove('drag-over'));s.addEventListener('drop',handleDrop);return s; }
        function createPlayerCard(p,isLeader=false) { const c=document.createElement('div');c.className='player-card'+(isLeader?' is-leader':'');c.innerHTML=`<div class="player-card-content"><div class="player-role-icon">${ROLE_ICONS[p.role]}</div><div class="player-info"><div class="player-name">${p.name}${isLeader?' <span class="leader-badge">ÌåÄÏû•</span>':''}</div><div class="player-meta"><span class="tier-badge ${getTierClass(p.tier)}">${p.tier}Ï†ê</span><span class="role-badge">${ROLE_NAMES[p.role]}</span></div></div></div>`;c.draggable=true;c.dataset.player=JSON.stringify(p);c.addEventListener('dragstart',handleDragStart);c.addEventListener('dragend',handleDragEnd);c.querySelector('.player-role-icon').onclick=e=>{e.stopPropagation();openRoleModal(p,'team');};return c; }
        function handleDragStart(e) { draggedElement=e.target;sourceContainer=e.target.parentElement;e.target.classList.add('dragging');e.dataTransfer.effectAllowed='move'; }
        function handleDragEnd(e) { e.target.classList.remove('dragging');document.querySelectorAll('.team-slot').forEach(s=>s.classList.remove('drag-over'));document.getElementById('spectatorsGrid').classList.remove('drag-over');updateTeamScores();updateSpectatorCount();updateSavedPlayersUI(); }
        function handleDrop(e) { e.stopPropagation();e.preventDefault();const ts=e.currentTarget;ts.classList.remove('drag-over');if(!draggedElement||!sourceContainer||sourceContainer===ts)return;const p=JSON.parse(draggedElement.dataset.player),ex=ts.querySelector('.player-card');const targetIndex=parseInt(ts.dataset.index);const isLeader=targetIndex===0;if(ex){const ep=JSON.parse(ex.dataset.player);ts.innerHTML='';ts.classList.remove('empty');if(sourceContainer.classList.contains('team-slot')){const srcIndex=parseInt(sourceContainer.dataset.index);const srcIsLeader=srcIndex===0;sourceContainer.innerHTML='';sourceContainer.classList.remove('empty');sourceContainer.appendChild(createPlayerCard(ep,srcIsLeader));}else{draggedElement.remove();addToSpectators(ep);}ts.appendChild(createPlayerCard(p,isLeader));}else{if(sourceContainer.classList.contains('team-slot')){sourceContainer.innerHTML='';sourceContainer.classList.add('empty');}else{draggedElement.remove();}ts.innerHTML='';ts.classList.remove('empty');ts.appendChild(createPlayerCard(p,isLeader));}updateTeamScores();updateSpectatorCount();updateSavedPlayersUI(); }
        function updateTeamScores() { let s1=0,s2=0;document.querySelectorAll('#team1 .player-card').forEach(c=>s1+=JSON.parse(c.dataset.player).tier);document.querySelectorAll('#team2 .player-card').forEach(c=>s2+=JSON.parse(c.dataset.player).tier);document.getElementById('team1Score').textContent=s1+'Ï†ê';document.getElementById('team2Score').textContent=s2+'Ï†ê';const d=Math.abs(s1-s2),de=document.getElementById('scoreDiff');de.textContent='Ï†êÏàòÏ∞®: '+d;de.classList.toggle('balanced',d<=1); }
        function getTeamLeaderName(teamNum) { const firstSlot=document.querySelector(`#team${teamNum} .team-slot:first-child .player-card`);if(firstSlot)return JSON.parse(firstSlot.dataset.player).name;return '-'; }

        function balancedRandomAssign() { const sp=getSpectatorPlayers();if(sp.length<2)return alert('Í¥ÄÏ†ÑÏûêÍ∞Ä 2Î™Ö Ïù¥ÏÉÅ ÌïÑÏöîÌï©ÎãàÎã§!');clearTeams();updateTeamSlots();const size=calculateTeamSize(),max=size*2;const assign=sp.slice(0,Math.min(sp.length,max)),remain=sp.slice(max);let best=null,bestScore=Infinity;for(let i=0;i<10000;i++){const sh=[...assign].sort(()=>Math.random()-0.5);const t1=sh.slice(0,size),t2=sh.slice(size,size*2);const d=Math.abs(t1.reduce((s,p)=>s+p.tier,0)-t2.reduce((s,p)=>s+p.tier,0));const r1=getRoleCounts(t1),r2=getRoleCounts(t2);let rd=0;Object.keys(r1).forEach(k=>rd+=Math.abs(r1[k]-r2[k]));const score=d+rd*10;if(score<bestScore){bestScore=score;best=sh;if(score===0)break;}}if(best){assignPlayersToTeams(best,size);const g=document.getElementById('spectatorsGrid');g.innerHTML='';remain.forEach(p=>addToSpectators(p));updateSpectatorCount();updateSavedPlayersUI();playSuccessSound();if(bestScore===0)setTimeout(()=>showSpecialEffect('ÏôÑÎ≤ΩÌïú Î∞∏Îü∞Ïä§!'),100);} }
        function spectatorRandomAssign() { const sp=getSpectatorPlayers();if(sp.length===0)return alert('Í¥ÄÏ†ÑÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§!');let empty=0;document.querySelectorAll('.team-slot').forEach(s=>{if(!s.querySelector('.player-card'))empty++;});if(empty===0)return alert('Îπà Ïä¨Î°ØÏù¥ ÏóÜÏäµÎãàÎã§!');const t1c=[],t2c=[];document.querySelectorAll('#team1 .player-card').forEach(c=>t1c.push(JSON.parse(c.dataset.player)));document.querySelectorAll('#team2 .player-card').forEach(c=>t2c.push(JSON.parse(c.dataset.player)));const size=calculateTeamSize(),toAssign=Math.min(sp.length,empty);let best=null,bestScore=Infinity;for(let i=0;i<10000;i++){const sh=[...sp].sort(()=>Math.random()-0.5).slice(0,toAssign);let t1=[...t1c],t2=[...t2c];sh.forEach(p=>{if(t1.length<size)t1.push(p);else if(t2.length<size)t2.push(p);});const d=Math.abs(t1.reduce((s,p)=>s+p.tier,0)-t2.reduce((s,p)=>s+p.tier,0));const r1=getRoleCounts(t1),r2=getRoleCounts(t2);let rd=0;Object.keys(r1).forEach(k=>rd+=Math.abs(r1[k]-r2[k]));const score=d+rd*10;if(score<bestScore){bestScore=score;best=sh;if(score===0)break;}}if(best){let idx=0;document.querySelectorAll('#team1 .team-slot').forEach((s,i)=>{if(!s.querySelector('.player-card')&&idx<best.length){s.innerHTML='';s.classList.remove('empty');s.appendChild(createPlayerCard(best[idx++],i===0));}});document.querySelectorAll('#team2 .team-slot').forEach((s,i)=>{if(!s.querySelector('.player-card')&&idx<best.length){s.innerHTML='';s.classList.remove('empty');s.appendChild(createPlayerCard(best[idx++],i===0));}});const g=document.getElementById('spectatorsGrid');g.innerHTML='';sp.slice(idx).forEach(p=>addToSpectators(p));updateSpectatorCount();updateTeamScores();updateSavedPlayersUI();playSuccessSound();} }

        function startAuction() { const sp=getSpectatorPlayers();if(sp.length<2)return alert('Í¥ÄÏ†ÑÏûêÍ∞Ä 2Î™Ö Ïù¥ÏÉÅ ÌïÑÏöîÌï©ÎãàÎã§!');updateTeamSlots();auctionPlayers=[...sp].sort(()=>Math.random()-0.5);currentAuctionIndex=0;currentBid={team:null,amount:0};bidHistory=[];team1Points=100;team2Points=100;updateTeamPoints();playAuctionStartSound();setTimeout(()=>shout('Í≤ΩÎß§Î•º ÏãúÏûëÌï©ÎãàÎã§!'),1200);setTimeout(()=>startBGM(),1800);showAuctionModal(); }
        function showAuctionModal() { if(currentAuctionIndex>=auctionPlayers.length){alert('Î™®Îì† Í≤ΩÎß§Í∞Ä ÎÅùÎÇ¨ÏäµÎãàÎã§!');closeAuction();return;}const p=auctionPlayers[currentAuctionIndex];const leader1=getTeamLeaderName(1);const leader2=getTeamLeaderName(2);document.getElementById('auctionLeader1Name').textContent=leader1!=='-'?leader1:'';document.getElementById('auctionLeader1Wrap').style.display=leader1!=='-'?'':'none';document.getElementById('auctionLeader2Name').textContent=leader2!=='-'?leader2:'';document.getElementById('auctionLeader2Wrap').style.display=leader2!=='-'?'':'none';document.getElementById('auctionPlayerIcon').textContent=ROLE_ICONS[p.role];document.getElementById('auctionPlayerName').textContent=p.name;document.getElementById('auctionPlayerTier').textContent=p.tier+'Ï†ê';document.getElementById('auctionPlayerRole').textContent=ROLE_ICONS[p.role]+' '+ROLE_NAMES[p.role];document.getElementById('auctionTeam1Points').textContent=team1Points;document.getElementById('auctionTeam2Points').textContent=team2Points;document.getElementById('team1BidInput').value='';document.getElementById('team2BidInput').value='';currentBid={team:null,amount:0};bidHistory=[];updateCurrentBidDisplay();updateBidHistory();updateLeadingTeam();updateRemainingPlayers();document.getElementById('team1BidBtn').disabled=team1Points===0;document.getElementById('team2BidBtn').disabled=team2Points===0;document.getElementById('auctionModal').classList.add('active');playNewPlayerSound();const order=currentAuctionIndex+1;setTimeout(()=>{shout(`${order}Î≤àÏß∏ ÏÑ†Ïàò! ${p.name}! ${p.tier}Ï†ê! ÏûÖÏ∞∞ ÏãúÏûë!`);},500);startAuctionTimer();setTimeout(()=>document.getElementById('team1BidInput').focus(),100); }
        function updateRemainingPlayers() { const g=document.getElementById('remainingGrid');g.innerHTML='';document.getElementById('remainingCount').textContent=(auctionPlayers.length-currentAuctionIndex)+'Î™Ö';auctionPlayers.forEach((p,i)=>{if(i>=currentAuctionIndex){const d=document.createElement('div');d.className='remaining-player'+(i===currentAuctionIndex?' current':'');d.innerHTML=`${ROLE_ICONS[p.role]} ${p.name} (${p.tier}Ï†ê)`;g.appendChild(d);}}); }
        function updateCurrentBidDisplay() { const v=document.getElementById('currentBidValue');if(currentBid.team===null){v.textContent='ÏûÖÏ∞∞ ÏóÜÏùå';v.className='current-bid-value none';}else{v.textContent=currentBid.team+'ÌåÄ - '+currentBid.amount+'P';v.className='current-bid-value team-'+currentBid.team;} }
        function updateLeadingTeam() { const b1=document.getElementById('auctionTeamBox1'),b2=document.getElementById('auctionTeamBox2');b1.classList.remove('leading');b2.classList.remove('leading');if(currentBid.team===1)b1.classList.add('leading');else if(currentBid.team===2)b2.classList.add('leading'); }
        function updateBidHistory() { const l=document.getElementById('bidHistoryList');l.innerHTML='';bidHistory.slice(-5).reverse().forEach(b=>{const d=document.createElement('div');d.className='bid-history-item team-'+b.team;d.textContent=b.team+'ÌåÄ: '+b.amount+'P';l.appendChild(d);}); }
        function quickBid(team,inc) { const inp=document.getElementById('team'+team+'BidInput');const min=currentBid.amount+1;inp.value=Math.max(min,(parseInt(inp.value)||min)+inc);playClickSound(); }
        function allInBid(team) { document.getElementById('team'+team+'BidInput').value=team===1?team1Points:team2Points;playAllInSound(); }
        function placeBid(team) { const amt=parseInt(document.getElementById('team'+team+'BidInput').value);const pts=team===1?team1Points:team2Points;if(isNaN(amt)||amt<0)return alert('Ïò¨Î∞îÎ•∏ ÏûÖÏ∞∞Í∞ÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî!');if(amt>pts)return alert('Ìè¨Ïù∏Ìä∏Í∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!');if(amt<=currentBid.amount)return alert(currentBid.amount+'P Î≥¥Îã§ ÎÜíÏïÑÏïº Ìï©ÎãàÎã§!');playBidSound();const isAllIn=amt===pts;if(isAllIn){playAllInSound();showSpecialEffect('Ïò¨Ïù∏!');setTimeout(()=>shout(`${team}ÌåÄ! Ïò¨Ïù∏! ${amt}Ìè¨Ïù∏Ìä∏!`),200);}else if(currentBid.amount>0&&amt===currentBid.amount+1){showSpecialEffect('ÌçºÌéôÌä∏ ÏûÖÏ∞∞!');shout(`${team}ÌåÄ! ${amt}!`);}else if(auctionTimeLeft<=2){showSpecialEffect('ÎßâÌåê ÏûÖÏ∞∞!');shout(`ÎßâÌåê Îí§ÏßëÍ∏∞! ${team}ÌåÄ! ${amt}!`);}else{speak(`${team}ÌåÄ, ${amt}!`,1.3,0.6);}currentBid={team,amount:amt};bidHistory.push({team,amount:amt});updateCurrentBidDisplay();updateLeadingTeam();updateBidHistory();resetAuctionTimer();const opp=team===1?'team2BidInput':'team1BidInput';const targetInput=document.getElementById(opp);targetInput.focus();targetInput.select(); }
        function passAuction() { if(currentBid.team!==null)return alert('ÏûÖÏ∞∞Ïù¥ ÏûàÏñ¥ÏÑú Ïú†Ï∞∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§!');playPassSound();const passed=auctionPlayers[currentAuctionIndex];speak(`${passed.name}, Ïú†Ï∞∞!`,1.0,0.5);auctionPlayers.splice(currentAuctionIndex,1);auctionPlayers.push(passed);resetAuctionTimer();if(currentAuctionIndex<auctionPlayers.length){currentBid={team:null,amount:0};bidHistory=[];showAuctionModal();}else{alert('Î™®Îì† Í≤ΩÎß§Í∞Ä ÎÅùÎÇ¨ÏäµÎãàÎã§!');closeAuction();} }
        function nextAuctionPlayer() { if(currentBid.team===null){if(team1Points===0&&team2Points>0)currentBid={team:2,amount:0};else if(team2Points===0&&team1Points>0)currentBid={team:1,amount:0};else return alert('ÏïÑÏßÅ ÏûÖÏ∞∞Ïù¥ ÏóÜÏäµÎãàÎã§!');}playSuccessSound();const p=auctionPlayers[currentAuctionIndex];if(currentBid.amount>0){shout(`ÎÇôÏ∞∞! ${p.name}! ${currentBid.team}ÌåÄ! ${currentBid.amount}Ìè¨Ïù∏Ìä∏!`);}else{shout(`${p.name}! ${currentBid.team}ÌåÄ Î∞∞Ï†ï!`);}if(currentBid.team===1)team1Points-=currentBid.amount;else team2Points-=currentBid.amount;updateTeamPoints();addPlayerToTeam(p,currentBid.team);removeFromSpectators(p);currentAuctionIndex++;resetAuctionTimer();if(currentAuctionIndex<auctionPlayers.length){if(team1Points===0||team2Points===0){stopAuctionTimer();autoAssignRemaining();}else setTimeout(()=>showAuctionModal(),1500);}else{stopAuctionTimer();stopBGM();playCompleteSound();showSpecialEffect('Í≤ΩÎß§ ÏôÑÎ£å!');setTimeout(()=>shout('Í≤ΩÎß§Í∞Ä Î™®Îëê ÎÅùÎÇ¨ÏäµÎãàÎã§! Ï¢ãÏùÄ Í≤ΩÍ∏∞ ÎêòÏÑ∏Ïöî!'),500);setTimeout(closeAuction,3000);} }
        function autoAssignRemaining() { const remain=auctionPlayers.slice(currentAuctionIndex);const target=team1Points===0?2:1;remain.forEach(p=>{addPlayerToTeam(p,target);removeFromSpectators(p);});playCompleteSound();stopBGM();showSpecialEffect('ÎÇ®ÏùÄ ÏÑ†Ïàò ‚Üí '+target+'ÌåÄ');shout(`ÎÇ®ÏùÄ ÏÑ†Ïàò Ï†ÑÏõê! ${target}ÌåÄ Î∞∞Ï†ï! Í≤ΩÎß§ Ï¢ÖÎ£å!`);setTimeout(closeAuction,2000); }
        function addPlayerToTeam(p,team) { const slots=document.querySelectorAll('#team'+team+' .team-slot');let slotIndex=0;for(let s of slots){if(!s.querySelector('.player-card')){s.innerHTML='';s.classList.remove('empty');s.appendChild(createPlayerCard(p,slotIndex===0));break;}slotIndex++;}updateTeamScores();updateSavedPlayersUI(); }
        function closeAuction() { stopAuctionTimer();stopBGM();speechSynthesis.cancel();document.getElementById('auctionModal').classList.remove('active'); }
        function assignPlayersToTeams(players,size) { const t1=document.querySelectorAll('#team1 .team-slot');const t2=document.querySelectorAll('#team2 .team-slot');let idx=0;for(let i=0;i<size&&idx<players.length;i++){t1[i].innerHTML='';t1[i].classList.remove('empty');t1[i].appendChild(createPlayerCard(players[idx++],i===0));}for(let i=0;i<size&&idx<players.length;i++){t2[i].innerHTML='';t2[i].classList.remove('empty');t2[i].appendChild(createPlayerCard(players[idx++],i===0));}updateTeamScores(); }
        function clearTeams() { document.querySelectorAll('.team-slot').forEach(s=>{s.innerHTML='';s.classList.add('empty');});updateTeamScores(); }
        function clearAll() { clearTeams();document.getElementById('spectatorsGrid').innerHTML='';team1Points=100;team2Points=100;updateTeamPoints();updateSpectatorCount();updateSavedPlayersUI();updateTeamSlots(); }

        function setupScreenshotFeature() { const section=document.getElementById('screenshotSection');const uploadArea=document.getElementById('screenshotUploadArea');const fileInput=document.getElementById('screenshotFileInput');const applyBtn=document.getElementById('screenshotApplyBtn');const cancelBtn=document.getElementById('screenshotCancelBtn');uploadArea.onclick=()=>fileInput.click();fileInput.onchange=e=>{if(e.target.files[0])processScreenshot(e.target.files[0]);};section.addEventListener('dragover',e=>{e.preventDefault();section.classList.add('drag-highlight');});section.addEventListener('dragleave',e=>{if(e.target===section||!section.contains(e.relatedTarget))section.classList.remove('drag-highlight');});section.addEventListener('drop',e=>{e.preventDefault();section.classList.remove('drag-highlight');const file=e.dataTransfer.files[0];if(file&&file.type.startsWith('image/'))processScreenshot(file);});document.addEventListener('paste',e=>{if(document.getElementById('auctionModal').classList.contains('active'))return;if(document.querySelector('.modal.active'))return;const active=document.activeElement;if(active&&(active.tagName==='INPUT'||(active.tagName==='TEXTAREA'&&active.id!=='screenshotNames')))return;const items=e.clipboardData.items;for(let item of items){if(item.type.startsWith('image/')){e.preventDefault();processScreenshot(item.getAsFile());break;}}});applyBtn.onclick=applyScreenshotNames;cancelBtn.onclick=cancelScreenshot; }

        function processScreenshot(file) { const reader=new FileReader();reader.onload=e=>{const imgData=e.target.result;document.getElementById('screenshotImg').src=imgData;document.getElementById('screenshotUploadArea').style.display='none';document.getElementById('screenshotLoading').classList.add('active');document.getElementById('screenshotPreview').classList.remove('active');performOCR(imgData);};reader.readAsDataURL(file); }

        async function performOCR(imgData) { try{if(!window.Tesseract){const script=document.createElement('script');script.src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js';document.head.appendChild(script);await new Promise((resolve,reject)=>{script.onload=resolve;script.onerror=()=>reject(new Error('Tesseract.js Î°úÎìú Ïã§Ìå®'));});}const result=await Tesseract.recognize(imgData,'kor+eng',{logger:m=>{if(m.status==='recognizing text'){const pct=Math.round((m.progress||0)*100);const loadingEl=document.querySelector('#screenshotLoading span');if(loadingEl)loadingEl.textContent=`Ïù¥ÎØ∏ÏßÄÏóêÏÑú Ïù¥Î¶ÑÏùÑ Ï∂îÏ∂úÌïòÎäî Ï§ë... ${pct}%`;}}});const rawText=result.data.text||'';const engToKor={'a':'ÏóêÏù¥','b':'ÎπÑ','c':'Ïî®','d':'Îîî','e':'Ïù¥','f':'ÏóêÌîÑ','g':'ÏßÄ','h':'ÏóêÏù¥Ïπò','i':'ÏïÑÏù¥','j':'Ï†úÏù¥','k':'ÏºÄÏù¥','l':'Ïóò','m':'Ïó†','n':'Ïóî','o':'Ïò§','p':'Ìîº','q':'ÌÅê','r':'Ïïå','s':'ÏóêÏä§','t':'Ìã∞','u':'Ïú†','v':'Î∏åÏù¥','w':'ÎçîÎ∏îÏú†','x':'ÏóëÏä§','y':'ÏôÄÏù¥','z':'Ï†úÌä∏','gay':'Í≤åÏù¥','lecode':'Î†àÏΩîÎìú','somu':'ÏÜåÎ¨¥'};function convertName(name){let cleaned=name.replace(/[^Í∞Ä-Ìû£a-zA-Z0-9\s]/g,'').trim();if(!cleaned)return'';if(/^\d+$/.test(cleaned))return'';const lowerCleaned=cleaned.toLowerCase();if(engToKor[lowerCleaned])return engToKor[lowerCleaned];const hasKorean=/[Í∞Ä-Ìû£]/.test(cleaned);if(hasKorean){cleaned=cleaned.replace(/[a-zA-Z0-9]/g,'').trim();}return cleaned;}const names=rawText.split('\n').map(line=>convertName(line)).filter(name=>name.length>0);document.getElementById('screenshotLoading').classList.remove('active');document.getElementById('screenshotPreview').classList.add('active');const textarea=document.getElementById('screenshotNames');if(names.length>0){textarea.value=names.join('\n');}else{textarea.value='';textarea.placeholder='OCR Ïù∏Ïãù Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§. ÏßÅÏ†ë ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî...';}textarea.focus();playClickSound();}catch(err){console.error('OCR ÏóêÎü¨:',err);document.getElementById('screenshotLoading').classList.remove('active');document.getElementById('screenshotPreview').classList.add('active');const textarea=document.getElementById('screenshotNames');textarea.value='';textarea.placeholder='OCR Î°úÎìú Ïã§Ìå®. Ïù¥Î¶ÑÏùÑ ÏßÅÏ†ë ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî...';textarea.focus();} }

        function applyScreenshotNames() { const text=document.getElementById('screenshotNames').value.trim();if(!text)return alert('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');const names=text.split('\n').map(n=>n.trim()).filter(n=>n.length>0);if(names.length===0)return alert('Ï∂îÍ∞ÄÌï† Ïù¥Î¶ÑÏù¥ ÏóÜÏäµÎãàÎã§!');const existingNames=new Set(savedPlayers.map(p=>p.name));let addedCount=0;let skippedNames=[];names.forEach(name=>{if(existingNames.has(name)){skippedNames.push(name);}else{savedPlayers.push({id:nextPlayerId++,name,tier:3,role:'ÎûúÎç§'});existingNames.add(name);addedCount++;}});saveCurrentTemplate();updateSavedPlayersUI();cancelScreenshot();playSuccessSound();let msg=`${addedCount}Î™Ö Ï∂îÍ∞Ä ÏôÑÎ£å!`;if(skippedNames.length>0){msg+=`\nÏ§ëÎ≥µ Í±¥ÎÑàÎúÄ: ${skippedNames.join(', ')}`;}alert(msg); }
        function cancelScreenshot() { document.getElementById('screenshotUploadArea').style.display='';document.getElementById('screenshotLoading').classList.remove('active');document.getElementById('screenshotPreview').classList.remove('active');document.getElementById('screenshotNames').value='';document.getElementById('screenshotFileInput').value=''; }

        init();
    </script>
</body>
</html>
