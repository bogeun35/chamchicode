<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì°¸ìŠ¤ ì½”ë“œ í”„ë¡œê·¸ë¨ (Compact Ver)</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --ow-orange: #FF9C00;
            --ow-blue: #00D3FF;
            --ow-dark: #0d1117;
            --ow-darker: #010409;
            --ow-gray: #1c2128;
            --ow-white: #f0f6fc;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--ow-darker);
            min-height: 100vh;
            color: var(--ow-white);
            overflow-x: hidden;
        }
        .hex-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background: linear-gradient(135deg, rgba(0,211,255,0.03) 0%, transparent 50%),
                        linear-gradient(225deg, rgba(255,156,0,0.03) 0%, transparent 50%), var(--ow-darker);
        }
        .hex-pattern {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.1;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%2300d3ff' fill-opacity='0.4'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 {
            font-family: 'Orbitron', sans-serif; font-size: 2em; font-weight: 900; letter-spacing: 0.1em;
            background: linear-gradient(135deg, var(--ow-blue), var(--ow-white), var(--ow-orange));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .header-subtitle { font-size: 0.9em; color: rgba(255,255,255,0.5); letter-spacing: 0.2em; }
        
        .controls {
            background: rgba(28,33,40,0.9); border: 1px solid rgba(0,211,255,0.2);
            padding: 15px; border-radius: 4px; margin-bottom: 20px; position: relative;
        }
        .controls::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--ow-blue), var(--ow-orange), transparent);
        }
        .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        .btn {
            font-family: 'Orbitron', sans-serif; padding: 10px 20px; border: none; border-radius: 4px;
            font-size: 11px; font-weight: 700; cursor: pointer; transition: all 0.3s; text-transform: uppercase;
        }
        .btn-balanced { background: linear-gradient(135deg, var(--ow-blue), #0099cc); color: white; }
        .btn-spectator { background: linear-gradient(135deg, #9d4edd, #7b2cbf); color: white; }
        .btn-auction { background: linear-gradient(135deg, var(--ow-orange), #cc7a00); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #dc3545, #a71d2a); color: white; }
        .btn-reset-spectator { background: linear-gradient(135deg, #6b7280, #4b5563); color: white; }
        .btn-add-all { background: linear-gradient(135deg, #48bb78, #2f855a); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        
        .teams-container {
            background: rgba(28,33,40,0.95); border: 1px solid rgba(255,255,255,0.1);
            padding: 20px; border-radius: 8px; margin-bottom: 20px;
        }
        .teams-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: start; margin-bottom: 20px; }
        .team { background: var(--ow-dark); border-radius: 8px; padding: 20px; }
        .team-1 { border: 2px solid var(--ow-blue); box-shadow: 0 0 30px rgba(0,211,255,0.2); }
        .team-2 { border: 2px solid var(--ow-orange); box-shadow: 0 0 30px rgba(255,156,0,0.2); }
        .team-header {
            font-family: 'Orbitron', sans-serif; font-size: 1.3em; font-weight: 700;
            margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; align-items: center;
        }
        .team-1 .team-header { color: var(--ow-blue); }
        .team-2 .team-header { color: var(--ow-orange); }
        .team-stats { display: flex; gap: 10px; }
        .team-score, .team-points {
            font-family: 'Orbitron', sans-serif; font-size: 0.6em;
            padding: 6px 10px; border-radius: 4px;
        }
        .team-score { background: rgba(255,255,255,0.1); }
        .team-points { background: linear-gradient(135deg, #d53f8c, #9d4edd); }
        
        .team-slots { display: flex; flex-direction: column; gap: 8px; min-height: 400px; }
        .team-slot {
            background: rgba(255,255,255,0.03); border: 2px dashed rgba(255,255,255,0.1);
            padding: 0; border-radius: 6px; 
            height: 60px;
            display: flex; align-items: center; justify-content: center; transition: all 0.3s;
            position: relative; overflow: hidden;
        }
        .team-slot.drag-over { background: rgba(255,255,255,0.1); border-style: solid; }
        .team-slot.empty::after {
            content: 'ë¹ˆ ìŠ¬ë¡¯'; font-family: 'Orbitron', sans-serif;
            color: rgba(255,255,255,0.15); font-size: 0.85em;
        }
        
        .player-card {
            width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--ow-gray), var(--ow-dark));
            border: 1px solid rgba(255,255,255,0.2); border-radius: 6px;
            padding: 0 12px;
            cursor: grab; transition: all 0.3s;
            display: flex; align-items: center;
        }
        .player-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .player-card.dragging { opacity: 0.3; }
        .player-card.is-leader { border: 2px solid gold; box-shadow: 0 0 15px rgba(255,215,0,0.4); }
        .player-card-content { display: flex; align-items: center; gap: 10px; width: 100%; }
        .player-role-icon {
            font-size: 1.5em; width: 36px; height: 36px;
            display: flex; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.05); border-radius: 50%; cursor: pointer;
            transition: all 0.2s;
        }
        .player-role-icon:hover { background: rgba(255,255,255,0.15); transform: scale(1.1); }
        .player-info { flex: 1; }
        .player-name { font-family: 'Orbitron', sans-serif; font-size: 1em; font-weight: 700; display: flex; align-items: center; gap: 6px; }
        .leader-badge { font-size: 0.7em; background: gold; color: #333; padding: 1px 4px; border-radius: 3px; }
        .player-meta { display: flex; gap: 6px; margin-top: 2px; }
        .tier-badge {
            font-family: 'Orbitron', sans-serif; font-size: 0.7em;
            padding: 2px 6px; border-radius: 3px; font-weight: 700;
        }
        .tier-bronze { background: linear-gradient(135deg, #cd7f32, #8b4513); color: white; }
        .tier-silver { background: linear-gradient(135deg, #c0c0c0, #808080); color: #333; }
        .tier-gold { background: linear-gradient(135deg, #ffd700, #daa520); color: #333; }
        .tier-platinum { background: linear-gradient(135deg, #00d4aa, #00a085); color: white; }
        .tier-diamond { background: linear-gradient(135deg, #b9f2ff, #87ceeb); color: #333; }
        .role-badge {
            font-size: 0.7em; padding: 2px 6px; border-radius: 3px;
            background: rgba(255,255,255,0.1); font-weight: 600;
        }
        
        .vs-divider { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .vs-text {
            font-family: 'Orbitron', sans-serif; font-size: 2.5em; font-weight: 900;
            background: linear-gradient(180deg, var(--ow-blue), var(--ow-orange));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .score-diff {
            font-family: 'Orbitron', sans-serif; font-size: 0.85em;
            background: var(--ow-gray); padding: 8px 15px; border-radius: 6px;
        }
        .score-diff.balanced { background: rgba(72,187,120,0.2); border: 1px solid #48bb78; color: #48bb78; }
        
        .spectators {
            background: var(--ow-dark); border: 2px solid rgba(157,78,221,0.5);
            border-radius: 8px; padding: 15px;
        }
        .spectators-header {
            font-family: 'Orbitron', sans-serif; font-size: 1.1em; font-weight: 700;
            color: #9d4edd; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .spectator-count { font-size: 0.7em; background: rgba(157,78,221,0.2); padding: 4px 10px; border-radius: 4px; }
        
        .spectators-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 8px; min-height: 150px; align-content: start;
            padding: 5px; border-radius: 6px;
        }
        .spectators-grid.drag-over { background: rgba(157,78,221,0.1); border: 2px dashed rgba(157,78,221,0.5); }
        .spectators-grid.empty::after {
            content: 'ê´€ì „ì ì—†ìŒ'; font-family: 'Orbitron', sans-serif;
            color: rgba(255,255,255,0.15); display: flex; align-items: center;
            justify-content: center; height: 100%; grid-column: 1 / -1;
        }
        
        .spectator-card {
            background: linear-gradient(135deg, #7b2cbf, #5a189a);
            border-radius: 6px; padding: 10px; cursor: grab; transition: all 0.3s; position: relative;
        }
        .spectator-card:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(157,78,221,0.4); }
        .spectator-card .remove-spectator-btn {
            position: absolute; top: 4px; right: 4px;
            background: rgba(239,68,68,0.8); border: none; color: white;
            width: 20px; height: 20px; border-radius: 50%; cursor: pointer; font-size: 10px;
        }
        .spectator-card .remove-spectator-btn:hover { background: #dc2626; }
        .spectator-name { font-family: 'Orbitron', sans-serif; font-size: 0.95em; font-weight: 700; margin-bottom: 4px; }
        .spectator-meta { display: flex; gap: 4px; flex-wrap: wrap; }
        .spectator-tier, .spectator-role {
            font-size: 0.7em; padding: 2px 6px; border-radius: 3px;
            background: rgba(255,255,255,0.2); font-weight: 600; cursor: pointer;
        }
        .spectator-tier:hover, .spectator-role:hover { background: rgba(255,255,255,0.4); }
        
        .player-list-container {
            background: rgba(28,33,40,0.95); border: 1px solid rgba(255,255,255,0.1);
            padding: 20px; border-radius: 8px; margin-bottom: 20px;
        }
        .section-title { font-family: 'Orbitron', sans-serif; font-size: 1em; font-weight: 700; margin-bottom: 10px; }
        .saved-players {
            display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;
            min-height: 40px; padding: 10px; background: rgba(255,255,255,0.02);
            border-radius: 6px; border: 1px dashed rgba(255,255,255,0.1);
        }
        .saved-player-tag {
            background: linear-gradient(135deg, var(--ow-blue), #0099cc); color: white;
            padding: 6px 10px; border-radius: 6px; font-size: 0.85em; font-weight: 600;
            display: flex; align-items: center; gap: 6px; cursor: pointer; transition: all 0.3s;
        }
        .saved-player-tag.selectable:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,211,255,0.4); }
        .saved-player-tag.in-spectator { background: linear-gradient(135deg, #7b2cbf, #5a189a); cursor: default; }
        .saved-player-tag.in-team { background: linear-gradient(135deg, #4a5568, #2d3748); opacity: 0.6; cursor: default; }
        .saved-player-tag .tier-badge-small {
            background: rgba(255,255,255,0.3); padding: 2px 6px; border-radius: 3px;
            font-size: 0.8em; font-weight: 700; cursor: pointer;
        }
        .saved-player-tag .tier-badge-small:hover { background: rgba(255,255,255,0.5); }
        .saved-player-tag .remove-btn {
            background: rgba(255,255,255,0.2); border: none; color: white;
            width: 18px; height: 18px; border-radius: 50%; cursor: pointer; font-size: 9px;
        }
        .saved-player-tag .remove-btn:hover { background: #dc2626; }
        .add-player-section { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .player-name-input, .tier-input {
            background: var(--ow-dark); border: 2px solid rgba(255,255,255,0.1);
            color: var(--ow-white); padding: 8px 10px; border-radius: 6px; font-size: 0.9em;
        }
        .player-name-input:focus, .tier-input:focus { outline: none; border-color: var(--ow-blue); }
        .player-name-input { flex: 1; min-width: 150px; }
        .tier-input { width: 60px; text-align: center; }
        .tier-input-label { color: rgba(255,255,255,0.5); font-weight: 600; font-size: 0.9em; }
        .add-player-btn {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #48bb78, #38a169); color: white;
            border: none; padding: 8px 16px; border-radius: 6px; font-size: 0.8em;
            font-weight: 700; cursor: pointer; transition: all 0.3s;
        }
        .add-player-btn:hover { transform: translateY(-2px); }
        .info-message {
            background: rgba(0,211,255,0.1); border: 1px solid rgba(0,211,255,0.2);
            padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 0.85em; color: rgba(255,255,255,0.6);
        }
        
        /* ìŠ¤í¬ë¦°ìƒ· ì—…ë¡œë“œ ì˜ì—­ */
        .screenshot-section {
            margin-top: 15px; padding: 15px;
            background: rgba(255,156,0,0.05); border: 2px dashed rgba(255,156,0,0.3);
            border-radius: 8px; transition: all 0.3s; position: relative;
        }
        .screenshot-section.drag-highlight {
            background: rgba(255,156,0,0.15); border-color: var(--ow-orange);
            box-shadow: 0 0 20px rgba(255,156,0,0.2);
        }
        .screenshot-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .screenshot-title { font-family: 'Orbitron', sans-serif; font-size: 0.9em; font-weight: 700; color: var(--ow-orange); }
        .screenshot-desc { font-size: 0.8em; color: rgba(255,255,255,0.4); }
        .screenshot-upload-area {
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            padding: 20px; cursor: pointer; text-align: center;
        }
        .screenshot-upload-area .upload-icon { font-size: 2em; }
        .screenshot-upload-area .upload-text { font-size: 0.85em; color: rgba(255,255,255,0.5); }
        .screenshot-upload-area .upload-text strong { color: var(--ow-orange); }
        #screenshotFileInput { display: none; }
        .screenshot-preview-area {
            display: none; gap: 15px; align-items: flex-start;
        }
        .screenshot-preview-area.active { display: flex; }
        .screenshot-preview {
            max-width: 200px; max-height: 200px; border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.2); flex-shrink: 0;
        }
        .screenshot-names-area { flex: 1; }
        .screenshot-names-textarea {
            width: 100%; min-height: 100px; background: var(--ow-dark);
            border: 2px solid rgba(255,255,255,0.1); color: var(--ow-white);
            padding: 10px; border-radius: 6px; font-size: 0.9em; font-family: 'Rajdhani', sans-serif;
            resize: vertical;
        }
        .screenshot-names-textarea:focus { outline: none; border-color: var(--ow-orange); }
        .screenshot-actions { display: flex; gap: 8px; margin-top: 8px; }
        .screenshot-btn {
            font-family: 'Orbitron', sans-serif; padding: 8px 16px; border: none;
            border-radius: 6px; font-size: 0.8em; font-weight: 700; cursor: pointer; transition: all 0.3s;
        }
        .screenshot-btn.apply { background: linear-gradient(135deg, var(--ow-orange), #cc7a00); color: white; }
        .screenshot-btn.cancel { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.6); }
        .screenshot-btn:hover { transform: translateY(-2px); }
        .screenshot-loading {
            display: none; align-items: center; gap: 10px; padding: 20px; justify-content: center;
        }
        .screenshot-loading.active { display: flex; }
        .screenshot-loading .spinner {
            width: 24px; height: 24px; border: 3px solid rgba(255,156,0,0.2);
            border-top-color: var(--ow-orange); border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ì‚¬ìš´ë“œ í† ê¸€ */
        .sound-toggle {
            position: fixed; top: 15px; right: 15px; z-index: 100;
            background: rgba(28,33,40,0.95); border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 14px; border-radius: 20px; cursor: pointer;
            font-family: 'Orbitron', sans-serif; font-size: 0.75em; font-weight: 700;
            color: var(--ow-white); transition: all 0.3s;
            display: flex; align-items: center; gap: 6px;
        }
        .sound-toggle:hover { border-color: var(--ow-blue); }
        .sound-toggle.muted { opacity: 0.5; }

        .template-section {
            background: rgba(255,255,255,0.02); padding: 12px;
            border-radius: 6px; border: 1px solid rgba(255,255,255,0.05);
        }
        .template-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 8px; }
        .template-buttons { display: flex; gap: 6px; flex-wrap: wrap; }
        .template-btn {
            padding: 6px 12px; border: 2px solid var(--ow-blue); background: transparent;
            color: var(--ow-blue); border-radius: 4px; cursor: pointer; font-size: 0.8em; font-weight: 700;
        }
        .template-btn:hover, .template-btn.active { background: var(--ow-blue); color: var(--ow-dark); }
        .template-actions { display: flex; gap: 6px; }
        .template-action-btn {
            padding: 6px 12px; border: none; border-radius: 4px;
            cursor: pointer; font-size: 0.8em; font-weight: 700;
        }
        .template-action-btn.save { background: linear-gradient(135deg, #48bb78, #38a169); color: white; }
        .template-action-btn.rename { background: linear-gradient(135deg, var(--ow-orange), #cc7a00); color: white; }
        
        /* ëª¨ë‹¬ ê³µí†µ */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: linear-gradient(135deg, var(--ow-gray), var(--ow-dark));
            border: 2px solid rgba(0,211,255,0.3); padding: 20px; border-radius: 8px;
            max-width: 350px; width: 90%;
        }
        .modal-title {
            font-family: 'Orbitron', sans-serif; font-size: 1.1em; font-weight: 700;
            margin-bottom: 15px; text-align: center;
        }
        .modal-input {
            width: 100%; background: var(--ow-dark); border: 2px solid rgba(255,255,255,0.1);
            color: var(--ow-white); padding: 10px; border-radius: 6px;
            font-size: 1em; text-align: center; margin-bottom: 15px;
        }
        .modal-input:focus { outline: none; border-color: var(--ow-blue); }
        .modal-buttons { display: flex; gap: 10px; }
        .modal-btn {
            flex: 1; font-family: 'Orbitron', sans-serif; padding: 10px;
            border: none; border-radius: 6px; font-size: 0.85em; font-weight: 700; cursor: pointer;
        }
        .modal-btn.save { background: linear-gradient(135deg, #48bb78, #38a169); color: white; }
        .modal-btn.cancel { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7); }
        .role-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .role-option {
            padding: 15px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px; cursor: pointer; text-align: center; font-size: 1em; font-weight: 700;
            color: rgba(255,255,255,0.7); transition: all 0.3s;
        }
        .role-option:hover { background: rgba(0,211,255,0.1); border-color: var(--ow-blue); }
        .role-option.selected { background: var(--ow-blue); border-color: var(--ow-blue); color: var(--ow-dark); }
        
        /* ê²½ë§¤ ëª¨ë‹¬ */
        .auction-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center;
            padding: 15px;
        }
        .auction-modal.active { display: flex; }
        .auction-content {
            background: linear-gradient(135deg, var(--ow-gray), var(--ow-dark));
            border: 2px solid var(--ow-orange); border-radius: 12px;
            max-width: 750px; width: 100%; 
            box-shadow: 0 0 60px rgba(255,156,0,0.3);
        }
        .auction-header {
            background: linear-gradient(135deg, var(--ow-orange), #cc7a00);
            padding: 10px 15px; border-radius: 10px 10px 0 0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .auction-title { font-family: 'Orbitron', sans-serif; font-size: 1.1em; font-weight: 900; color: white; }
        #auctionLeader1Name { 
            color: #fff; font-weight: 900; 
            text-shadow: 0 0 8px rgba(0,211,255,0.5);
        }
        #auctionLeader2Name { 
            color: #fff; font-weight: 900; 
            text-shadow: 0 0 8px rgba(255,156,0,0.5);
        }
        .auction-team-name { white-space: nowrap; }
        
        .auction-body { padding: 15px; }
        
        .auction-top-section { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        
        .timer-container { position: relative; width: 80px; height: 80px; flex-shrink: 0; }
        .timer-ring { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .timer-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
        .timer-ring-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 6; }
        .timer-ring-progress {
            fill: none; stroke: var(--ow-orange); stroke-width: 6; stroke-linecap: round;
            stroke-dasharray: 314; stroke-dashoffset: 0; transition: stroke-dashoffset 0.1s linear;
        }
        .timer-ring-progress.warning { stroke: #ef4444; }
        .timer-display { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .timer-seconds { font-family: 'Orbitron', sans-serif; font-size: 1.8em; font-weight: 900; line-height: 1; }
        .timer-seconds.warning { color: #ef4444; animation: timerPulse 0.5s ease-in-out infinite; }
        .timer-label { font-size: 0.6em; color: rgba(255,255,255,0.4); }
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .auction-current-player {
            flex: 1; display: flex; align-items: center; justify-content: space-between;
            background: linear-gradient(135deg, rgba(255,156,0,0.2), rgba(255,156,0,0.05));
            border: 2px solid var(--ow-orange); border-radius: 8px; padding: 10px 20px;
        }
        .auction-player-info-wrapper { display: flex; align-items: center; gap: 15px; }
        .auction-player-role-icon { font-size: 2.2em; }
        .auction-player-name { font-family: 'Orbitron', sans-serif; font-size: 1.4em; font-weight: 900; }
        .auction-player-stats { display: flex; gap: 8px; }
        .auction-player-tier, .auction-player-role {
            font-family: 'Orbitron', sans-serif; font-size: 0.8em;
            padding: 4px 10px; border-radius: 4px; font-weight: 700;
        }
        .auction-player-tier { background: rgba(255,255,255,0.15); }
        .auction-player-role { background: rgba(255,255,255,0.25); }
        
        .current-bid-display {
            background: var(--ow-dark); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px; padding: 8px; text-align: center; margin-bottom: 15px;
        }
        .current-bid-label { font-size: 0.75em; color: rgba(255,255,255,0.4); margin-bottom: 2px; }
        .current-bid-value { font-family: 'Orbitron', sans-serif; font-size: 1.2em; font-weight: 900; }
        .current-bid-value.team-1 { color: var(--ow-blue); }
        .current-bid-value.team-2 { color: var(--ow-orange); }
        .current-bid-value.none { color: rgba(255,255,255,0.2); }
        
        .auction-teams-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .auction-team-box {
            background: var(--ow-dark); border-radius: 8px; padding: 10px; text-align: center;
            border: 2px solid transparent; transition: all 0.3s;
        }
        .auction-team-box.team-1 { border-color: rgba(0,211,255,0.3); }
        .auction-team-box.team-2 { border-color: rgba(255,156,0,0.3); }
        .auction-team-box.leading.team-1 { background: rgba(0,211,255,0.1); border-color: var(--ow-blue); }
        .auction-team-box.leading.team-2 { background: rgba(255,156,0,0.1); border-color: var(--ow-orange); }
        
        .auction-team-header-row { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 5px; }
        .auction-team-name { font-family: 'Orbitron', sans-serif; font-size: 0.9em; font-weight: 700; }
        .team-1 .auction-team-name { color: var(--ow-blue); }
        .team-2 .auction-team-name { color: var(--ow-orange); }
        .auction-team-points { font-family: 'Orbitron', sans-serif; font-size: 1.2em; font-weight: 900; }
        .team-1 .auction-team-points { color: var(--ow-blue); }
        .team-2 .auction-team-points { color: var(--ow-orange); }
        
        .auction-bid-input {
            width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: var(--ow-white); padding: 6px; border-radius: 4px;
            font-family: 'Orbitron', sans-serif; font-size: 1em; text-align: center; margin-bottom: 6px;
        }
        .quick-bid-row { display: flex; gap: 4px; margin-bottom: 6px; }
        .quick-bid-btn {
            flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.7); padding: 6px 2px; border-radius: 4px;
            font-size: 0.7em; font-weight: 700; cursor: pointer;
        }
        .quick-bid-btn:hover { background: rgba(255,255,255,0.1); }
        .auction-bid-btn {
            width: 100%; padding: 8px; border: none; border-radius: 4px;
            font-family: 'Orbitron', sans-serif; font-size: 0.85em; font-weight: 700; cursor: pointer;
        }
        .team-1 .auction-bid-btn { background: linear-gradient(135deg, var(--ow-blue), #0099cc); color: white; }
        .team-2 .auction-bid-btn { background: linear-gradient(135deg, var(--ow-orange), #cc7a00); color: white; }
        .auction-bid-btn:disabled { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.3); cursor: not-allowed; }
        
        .bid-history {
            background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 6px; padding: 8px; margin-bottom: 10px; max-height: 60px; overflow-y: auto;
        }
        .bid-history-title { font-size: 0.7em; color: rgba(255,255,255,0.3); margin-bottom: 4px; }
        .bid-history-list { display: flex; flex-direction: column; gap: 2px; }
        .bid-history-item { font-size: 0.75em; padding: 2px 6px; border-radius: 3px; }
        .bid-history-item.team-1 { background: rgba(0,211,255,0.1); border-left: 2px solid var(--ow-blue); color: var(--ow-blue); }
        .bid-history-item.team-2 { background: rgba(255,156,0,0.1); border-left: 2px solid var(--ow-orange); color: var(--ow-orange); }
        
        .remaining-players {
            background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 6px; padding: 8px; margin-bottom: 10px;
        }
        .remaining-title { font-size: 0.7em; color: rgba(255,255,255,0.3); margin-bottom: 5px; display: flex; justify-content: space-between; }
        .remaining-grid { display: flex; flex-wrap: wrap; gap: 4px; }
        .remaining-player {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 3px; padding: 4px 8px; font-size: 0.75em;
        }
        .remaining-player.current {
            background: linear-gradient(135deg, rgba(255,156,0,0.3), rgba(255,156,0,0.1));
            border-color: var(--ow-orange);
        }
        .auction-controls { display: flex; gap: 8px; }
        .auction-control-btn {
            flex: 1; font-family: 'Orbitron', sans-serif; padding: 10px;
            border: none; border-radius: 4px; font-size: 0.8em; font-weight: 700; cursor: pointer;
        }
        .auction-pass-btn { background: linear-gradient(135deg, #9d4edd, #7b2cbf); color: white; }
        .auction-next-btn { background: linear-gradient(135deg, #48bb78, #38a169); color: white; }
        .auction-close-btn { background: linear-gradient(135deg, #dc3545, #a71d2a); color: white; }
        
        .special-effect {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-family: 'Orbitron', sans-serif; font-size: 2em; font-weight: 900;
            color: var(--ow-orange); text-shadow: 0 0 30px rgba(255,156,0,0.8);
            z-index: 3000; pointer-events: none; animation: specialPop 1.5s ease-out forwards;
        }
        @keyframes specialPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5) translateY(-50px); }
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .teams-grid { grid-template-columns: 1fr; gap: 20px; }
            .vs-divider { flex-direction: row; }
            .vs-text { font-size: 2em; }
            .action-buttons { flex-direction: column; }
            .btn { width: 100%; }
            .auction-teams-row { grid-template-columns: 1fr; }
            .auction-top-section { flex-direction: column; }
            .screenshot-preview-area.active { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="hex-background"></div>
    <div class="hex-pattern"></div>
    
    <!-- ì‚¬ìš´ë“œ í† ê¸€ -->
    <div class="sound-toggle" id="soundToggle" onclick="toggleSound()">
        <span id="soundIcon">ğŸ”Š</span> <span id="soundLabel">ON</span>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>âš½ ì°¸ìŠ¤ì½”ë“œ í”„ë¡œê·¸ë¨</h1>
            <div class="header-subtitle">ì°¸ìŠ¤ì½”ë“œ ê²½ë§¤ ì‹œìŠ¤í…œ Pro</div>
        </div>
        <div class="controls">
            <div class="action-buttons">
                <button class="btn btn-balanced" id="balancedBtn">âš–ï¸ ë°¸ëŸ°ìŠ¤ ëœë¤</button>
                <button class="btn btn-spectator" id="spectatorRandomBtn">ğŸ‘¥ ê´€ì „ì ëœë¤</button>
                <button class="btn btn-auction" id="auctionBtn">ğŸ”¨ ê²½ë§¤í•˜ê¸°</button>
                <button class="btn btn-reset-spectator" id="resetToSpectatorBtn">â¬‡ï¸ ëª¨ë‘ ê´€ì „ìë¡œ ë‚´ë¦¬ê¸°</button>
                <button class="btn btn-add-all" id="addAllToSpectatorBtn">â¬†ï¸ ëŒ€ê¸°ì ì „ì› ê´€ì „</button>
                <button class="btn btn-secondary" id="clearTeamsBtn">ğŸ”„ ì „ì²´ ì´ˆê¸°í™”</button>
            </div>
        </div>
        <div class="teams-container">
            <div class="teams-grid">
                <div class="team team-1">
                    <div class="team-header">
                        <span>1íŒ€</span>
                        <div class="team-stats">
                            <span class="team-score" id="team1Score">0ì </span>
                            <span class="team-points" id="team1Points">100P</span>
                        </div>
                    </div>
                    <div class="team-slots" id="team1"></div>
                </div>
                <div class="vs-divider">
                    <div class="vs-text">VS</div>
                    <div class="score-diff" id="scoreDiff">ì ìˆ˜ì°¨: 0</div>
                </div>
                <div class="team team-2">
                    <div class="team-header">
                        <span>2íŒ€</span>
                        <div class="team-stats">
                            <span class="team-score" id="team2Score">0ì </span>
                            <span class="team-points" id="team2Points">100P</span>
                        </div>
                    </div>
                    <div class="team-slots" id="team2"></div>
                </div>
            </div>
            <div class="spectators">
                <div class="spectators-header">
                    <span>ğŸ‘¥ ê´€ì „ì</span>
                    <span class="spectator-count" id="spectatorCount">0ëª…</span>
                </div>
                <div class="spectators-grid empty" id="spectatorsGrid"></div>
            </div>
        </div>
        <div class="player-list-container">
            <div class="player-input-section">
                <div class="section-title">ì°¸ê°€ì ëª©ë¡</div>
                <div class="saved-players" id="savedPlayers">
                    <span style="color:rgba(255,255,255,0.2)">ì €ì¥ëœ ì°¸ê°€ì ì—†ìŒ</span>
                </div>
                <div class="add-player-section">
                    <input type="text" class="player-name-input" id="newPlayerInput" placeholder="ì°¸ê°€ì ì´ë¦„...">
                    <span class="tier-input-label">í‹°ì–´:</span>
                    <input type="number" class="tier-input" id="newTierInput" value="3" min="1">
                    <button class="add-player-btn" id="addPlayerBtn">â• ì¶”ê°€</button>
                </div>
                <div class="info-message">ğŸ’¡ [F1]: ë‚™ì°° / [F2]: ìœ ì°° / [Tab]: ì…ë ¥ì°½ ì „í™˜ / ìŠ¤í¬ë¦°ìƒ·ì„ ì•„ë˜ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V)í•˜ë©´ ìë™ ì¸ì‹!</div>
                
                <!-- ìŠ¤í¬ë¦°ìƒ· ì—…ë¡œë“œ ì˜ì—­ -->
                <div class="screenshot-section" id="screenshotSection">
                    <div class="screenshot-header">
                        <div class="screenshot-title">ğŸ“¸ ìŠ¤í¬ë¦°ìƒ·ìœ¼ë¡œ ì°¸ê°€ì ì¶”ê°€</div>
                        <div class="screenshot-desc">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜, í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•˜ê±°ë‚˜, Ctrl+Vë¡œ ë¶™ì—¬ë„£ê¸°</div>
                    </div>
                    <div class="screenshot-upload-area" id="screenshotUploadArea">
                        <div class="upload-icon">ğŸ“‹</div>
                        <div class="upload-text"><strong>í´ë¦­</strong> ë˜ëŠ” <strong>ë“œë˜ê·¸</strong> ë˜ëŠ” <strong>Ctrl+V</strong></div>
                    </div>
                    <input type="file" id="screenshotFileInput" accept="image/*">
                    <div class="screenshot-loading" id="screenshotLoading">
                        <div class="spinner"></div>
                        <span>ì´ë¯¸ì§€ì—ì„œ ì´ë¦„ì„ ì¶”ì¶œí•˜ëŠ” ì¤‘...</span>
                    </div>
                    <div class="screenshot-preview-area" id="screenshotPreview">
                        <img class="screenshot-preview" id="screenshotImg" src="">
                        <div class="screenshot-names-area">
                            <div style="font-size:0.8em; color:rgba(255,255,255,0.4); margin-bottom:4px;">ì¸ì‹ëœ ì´ë¦„ (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„, ìˆ˜ì • ê°€ëŠ¥):</div>
                            <textarea class="screenshot-names-textarea" id="screenshotNames" placeholder="ì´ë¦„ì„ í•œ ì¤„ì— í•˜ë‚˜ì”© ì…ë ¥..."></textarea>
                            <div class="screenshot-actions">
                                <button class="screenshot-btn apply" id="screenshotApplyBtn">âœ… ì°¸ê°€ìì— ì¶”ê°€</button>
                                <button class="screenshot-btn cancel" id="screenshotCancelBtn">âœ• ì·¨ì†Œ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="template-section">
                <div class="template-header">
                    <div class="section-title">í…œí”Œë¦¿</div>
                    <div class="template-actions">
                        <button class="template-action-btn save" id="saveTemplateBtn">ğŸ’¾ ì €ì¥</button>
                        <button class="template-action-btn rename" id="renameTemplateBtn">âœï¸ ì´ë¦„ë³€ê²½</button>
                    </div>
                </div>
                <div class="template-buttons" id="templateButtons"></div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="tierModal">
        <div class="modal-content">
            <div class="modal-title">í‹°ì–´ ìˆ˜ì •</div>
            <input type="number" class="modal-input" id="tierModalInput" min="1">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="tierModalCancel">ì·¨ì†Œ</button>
                <button class="modal-btn save" id="tierModalSave">ì €ì¥</button>
            </div>
        </div>
    </div>
    <div class="modal" id="roleModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-title" id="roleModalTitle">ì—­í•  ì„ íƒ</div>
            <div class="role-selector">
                <div class="role-option" data-role="íƒ±ì»¤">ğŸ›¡ï¸<br>íƒ±ì»¤</div>
                <div class="role-option" data-role="ë”œëŸ¬">âš”ï¸<br>ë”œëŸ¬</div>
                <div class="role-option" data-role="íëŸ¬">â¤ï¸<br>íëŸ¬</div>
                <div class="role-option" data-role="ëœë¤">ğŸ²<br>ëœë¤</div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="roleModalCancel">ì·¨ì†Œ</button>
                <button class="modal-btn save" id="roleModalSave">í™•ì¸</button>
            </div>
        </div>
    </div>
    <div class="modal" id="templateNameModal">
        <div class="modal-content">
            <div class="modal-title" id="templateNameModalTitle">í…œí”Œë¦¿ ì´ë¦„</div>
            <input type="text" class="modal-input" id="templateNameInput" placeholder="ì´ë¦„ ì…ë ¥...">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="templateNameCancel">ì·¨ì†Œ</button>
                <button class="modal-btn save" id="templateNameSave">ì €ì¥</button>
            </div>
        </div>
    </div>
    <div class="auction-modal" id="auctionModal">
        <div class="auction-content">
            <div class="auction-header">
                <div class="auction-title">ğŸ”¨ ê²½ë§¤ ì§„í–‰ì¤‘</div>
            </div>
            <div class="auction-body">
                <div class="auction-top-section">
                    <div class="timer-container">
                        <div class="timer-ring">
                            <svg viewBox="0 0 120 120">
                                <circle class="timer-ring-bg" cx="60" cy="60" r="50"></circle>
                                <circle class="timer-ring-progress" id="timerProgress" cx="60" cy="60" r="50"></circle>
                            </svg>
                        </div>
                        <div class="timer-display">
                            <div class="timer-seconds" id="timerSeconds">6</div>
                            <div class="timer-label">ì´ˆ</div>
                        </div>
                    </div>
                    <div class="auction-current-player">
                        <div class="auction-player-info-wrapper">
                            <div class="auction-player-role-icon" id="auctionPlayerIcon">ğŸ²</div>
                            <div class="auction-player-name" id="auctionPlayerName">í”Œë ˆì´ì–´</div>
                        </div>
                        <div class="auction-player-stats">
                            <div class="auction-player-tier" id="auctionPlayerTier">3ì </div>
                            <div class="auction-player-role" id="auctionPlayerRole">ëœë¤</div>
                        </div>
                    </div>
                </div>

                <div class="current-bid-display">
                    <div class="current-bid-label">í˜„ì¬ ì…ì°°</div>
                    <div class="current-bid-value none" id="currentBidValue">ì…ì°° ì—†ìŒ</div>
                </div>
                <div class="auction-teams-row">
                    <div class="auction-team-box team-1" id="auctionTeamBox1">
                        <div class="auction-team-header-row">
                            <div class="auction-team-name">1íŒ€ ğŸ‘‘<span id="auctionLeader1Wrap"> (<span id="auctionLeader1Name"></span>)</span></div>
                            <div class="auction-team-points" id="auctionTeam1Points">100</div>
                        </div>
                        <input type="number" class="auction-bid-input" id="team1BidInput" min="0" placeholder="ì…ì°°ê°€">
                        <div class="quick-bid-row">
                            <button class="quick-bid-btn" onclick="quickBid(1,1)">+1</button>
                            <button class="quick-bid-btn" onclick="quickBid(1,5)">+5</button>
                            <button class="quick-bid-btn" onclick="quickBid(1,10)">+10</button>
                            <button class="quick-bid-btn" onclick="allInBid(1)">ì˜¬ì¸</button>
                        </div>
                        <button class="auction-bid-btn" id="team1BidBtn">ì…ì°°</button>
                    </div>
                    <div class="auction-team-box team-2" id="auctionTeamBox2">
                        <div class="auction-team-header-row">
                            <div class="auction-team-name">2íŒ€ ğŸ‘‘<span id="auctionLeader2Wrap"> (<span id="auctionLeader2Name"></span>)</span></div>
                            <div class="auction-team-points" id="auctionTeam2Points">100</div>
                        </div>
                        <input type="number" class="auction-bid-input" id="team2BidInput" min="0" placeholder="ì…ì°°ê°€">
                        <div class="quick-bid-row">
                            <button class="quick-bid-btn" onclick="quickBid(2,1)">+1</button>
                            <button class="quick-bid-btn" onclick="quickBid(2,5)">+5</button>
                            <button class="quick-bid-btn" onclick="quickBid(2,10)">+10</button>
                            <button class="quick-bid-btn" onclick="allInBid(2)">ì˜¬ì¸</button>
                        </div>
                        <button class="auction-bid-btn" id="team2BidBtn">ì…ì°°</button>
                    </div>
                </div>
                <div class="bid-history">
                    <div class="bid-history-title">ì…ì°° ê¸°ë¡</div>
                    <div class="bid-history-list" id="bidHistoryList"></div>
                </div>
                <div class="remaining-players">
                    <div class="remaining-title">
                        <span>ëŒ€ê¸° ì„ ìˆ˜</span>
                        <span id="remainingCount">0ëª…</span>
                    </div>
                    <div class="remaining-grid" id="remainingGrid"></div>
                </div>
                <div class="auction-controls">
                    <button class="auction-control-btn auction-pass-btn" id="auctionPassBtn">â­ï¸ ìœ ì°° (F2)</button>
                    <button class="auction-control-btn auction-next-btn" id="auctionNextBtn">âœ“ ë‚™ì°° (F1)</button>
                    <button class="auction-control-btn auction-close-btn" id="auctionCloseBtn">âœ• ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ============================================================
        // ğŸ”Š ì‚¬ìš´ë“œ ì‹œìŠ¤í…œ (ë‘ ë°”ë‘ ë°” í‚¥/ë² ì´ìŠ¤ BGM + ê¹¨ë—í•œ íš¨ê³¼ìŒ)
        // ============================================================
        let soundEnabled = true;
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;
        let bgmPlaying = false;
        let bgmTimeout = null;
        let bgmStopped = false;

        function getAudioCtx() {
            if (!audioCtx) audioCtx = new AudioCtx();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            return audioCtx;
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundIcon').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            document.getElementById('soundLabel').textContent = soundEnabled ? 'ON' : 'OFF';
            document.getElementById('soundToggle').classList.toggle('muted', !soundEnabled);
            if (!soundEnabled) { stopBGM(); speechSynthesis.cancel(); }
        }

        // --- í•œêµ­ì–´ TTS (ë‚®ê³  í˜ìˆëŠ” ë‚¨ì„± ëª©ì†Œë¦¬) ---
        function speak(text, rate = 1.0, pitch = 0.7) {
            if (!soundEnabled) return;
            try {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'ko-KR';
                u.rate = rate;
                u.pitch = pitch;
                u.volume = 1.0;
                const voices = speechSynthesis.getVoices();
                const maleKo = voices.find(v => v.lang.startsWith('ko') && (v.name.toLowerCase().includes('male') || v.name.includes('ë‚¨')));
                const koVoice = maleKo || voices.find(v => v.lang.startsWith('ko'));
                if (koVoice) u.voice = koVoice;
                speechSynthesis.cancel();
                speechSynthesis.speak(u);
            } catch(e) {}
        }

        function shout(text) {
            speak(text, 1.1, 0.55);
        }

        // --- í‚¥ ë“œëŸ¼ (ë¶€ë“œëŸ¬ìš´ "ë‘ ") ---
        function playKick(volume = 0.3) {
            if (!soundEnabled) return;
            try {
                const ctx = getAudioCtx();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                // í‚¥: ë†’ì€ ì£¼íŒŒìˆ˜ì—ì„œ ë¹ ë¥´ê²Œ í•˜ê°• â†’ "ë‘ " ì†Œë¦¬
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(40, ctx.currentTime + 0.12);
                gain.gain.setValueAtTime(volume, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.35);
            } catch(e) {}
        }

        // --- ì„œë¸Œ ë² ì´ìŠ¤ (ê¹Šì€ "ë°”") ---
        function playSubBass(freq = 55, duration = 0.25, volume = 0.2) {
            if (!soundEnabled) return;
            try {
                const ctx = getAudioCtx();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, ctx.currentTime);
                gain.gain.setValueAtTime(volume, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + duration + 0.05);
            } catch(e) {}
        }

        // --- ë¶€ë“œëŸ¬ìš´ í†¤ (ì‚¬ì¸íŒŒë§Œ, ê·€ ì•ˆ ì•„í””) ---
        function playTone(freq, duration, volume = 0.1) {
            if (!soundEnabled) return;
            try {
                const ctx = getAudioCtx();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, ctx.currentTime);
                gain.gain.setValueAtTime(volume, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + duration + 0.05);
            } catch(e) {}
        }

        // --- ë¶€ë“œëŸ¬ìš´ ì½”ë“œ ---
        function playChord(freqs, duration, volume = 0.06) {
            freqs.forEach(f => playTone(f, duration, volume));
        }

        // ===== BGM: ë‘ ë°”ë‘ ë°” í‚¥ ë£¨í”„ =====
        // íŒ¨í„´: ë‘ -ë°”-ë‘ ë‘ -ë°” (4/4 ë¦¬ë“¬)
        let bgmVolume = 0.2;
        let bgmBeat = 0;

        function startBGM() {
            if (!soundEnabled || bgmPlaying) return;
            bgmPlaying = true;
            bgmStopped = false;
            bgmVolume = 0.15;
            bgmBeat = 0;
            bgmLoop();
        }

        function bgmLoop() {
            if (bgmStopped || !bgmPlaying) return;

            // ë‘ ë°”ë‘ ë‘ ë°” íŒ¨í„´ (8ë¹„íŠ¸ ê¸°ì¤€)
            // 0: í‚¥(ë‘ ) | 1: - | 2: ë² ì´ìŠ¤(ë°”) | 3: - | 4: í‚¥(ë‘ ) | 5: í‚¥(ë‘ ) | 6: ë² ì´ìŠ¤(ë°”) | 7: -
            const pattern = bgmBeat % 8;
            const v = bgmVolume;

            if (pattern === 0) {
                playKick(v);
            } else if (pattern === 2) {
                playSubBass(65, 0.2, v * 0.7);
            } else if (pattern === 4) {
                playKick(v * 0.85);
            } else if (pattern === 5) {
                playKick(v * 0.6);
            } else if (pattern === 6) {
                playSubBass(55, 0.2, v * 0.7);
            }

            bgmBeat++;
            // ~138 BPM (8ë¶„ìŒí‘œ ê°„ê²© = ì•½ 217ms)
            bgmTimeout = setTimeout(() => bgmLoop(), 217);
        }

        function stopBGM() {
            bgmStopped = true;
            bgmPlaying = false;
            if (bgmTimeout) { clearTimeout(bgmTimeout); bgmTimeout = null; }
        }

        function setBGMTension(level) {
            // level 0~1, BGM ë³¼ë¥¨ë§Œ ì‚´ì§ í‚¤ì›€
            bgmVolume = 0.12 + level * 0.15;
        }

        // ===== íš¨ê³¼ìŒ (í‚¥ + ì„œë¸Œë² ì´ìŠ¤ë§Œ, ê³ ìŒ ì—†ìŒ) =====

        function playBidSound() {
            playKick(0.25);
            setTimeout(() => playSubBass(80, 0.15, 0.15), 60);
        }

        function playSuccessSound() {
            // ë‚™ì°°: í‚¥ + ê¹Šì€ ë² ì´ìŠ¤ ìƒìŠ¹
            playKick(0.35);
            setTimeout(() => playSubBass(55, 0.3, 0.2), 100);
            setTimeout(() => playKick(0.3), 300);
            setTimeout(() => playSubBass(65, 0.3, 0.2), 400);
            setTimeout(() => {
                playKick(0.35);
                playSubBass(82, 0.5, 0.25);
            }, 600);
        }

        function playPassSound() {
            // ìœ ì°°: í•˜ê°• ë² ì´ìŠ¤
            playSubBass(80, 0.2, 0.12);
            setTimeout(() => playSubBass(60, 0.2, 0.1), 150);
            setTimeout(() => playSubBass(40, 0.3, 0.08), 300);
        }

        function playTimerWarningSound() {
            playKick(0.25);
        }

        function playTimerEndSound() {
            playSubBass(80, 0.5, 0.2);
            setTimeout(() => playSubBass(50, 0.5, 0.15), 250);
        }

        function playAuctionStartSound() {
            // ê²½ë§¤ ì‹œì‘: í‚¥ 4ì—°íƒ€ â†’ ë² ì´ìŠ¤
            for (let i = 0; i < 4; i++) {
                setTimeout(() => playKick(0.25 + i * 0.03), i * 150);
            }
            setTimeout(() => playSubBass(65, 0.4, 0.25), 650);
            setTimeout(() => {
                playKick(0.35);
                playSubBass(82, 0.5, 0.25);
            }, 900);
        }

        function playAllInSound() {
            playKick(0.35);
            setTimeout(() => playKick(0.35), 80);
            setTimeout(() => playKick(0.35), 160);
            setTimeout(() => playSubBass(40, 0.6, 0.3), 280);
        }

        function playCompleteSound() {
            // ê²½ë§¤ ì™„ë£Œ: í‚¥ íŒ¨í„´ + ë² ì´ìŠ¤
            for (let i = 0; i < 6; i++) {
                setTimeout(() => playKick(0.2 + i * 0.02), i * 120);
            }
            setTimeout(() => {
                playKick(0.35);
                playSubBass(55, 0.6, 0.25);
            }, 750);
            setTimeout(() => {
                playKick(0.35);
                playSubBass(82, 0.8, 0.25);
            }, 1100);
        }

        function playClickSound() {
            playKick(0.08);
        }

        function playNewPlayerSound() {
            // ì„ ìˆ˜ ë“±ì¥: í‚¥ ë“œëŸ¼ë¡¤ â†’ ì„íŒ©íŠ¸
            for (let i = 0; i < 6; i++) {
                setTimeout(() => playKick(0.1 + i * 0.04), i * 55);
            }
            setTimeout(() => {
                playKick(0.35);
                playSubBass(65, 0.3, 0.2);
            }, 380);
        }

        // ============================================================
        // ì „ì—­ ë³€ìˆ˜
        // ============================================================
        let savedPlayers = [], draggedElement = null, sourceContainer = null, nextPlayerId = 1;
        let editingPlayerId = null, editingSpectatorId = null, editingTeamPlayerId = null, selectedRole = null;
        let team1Points = 100, team2Points = 100, auctionPlayers = [], currentAuctionIndex = 0;
        let currentBid = { team: null, amount: 0 }, bidHistory = [];
        let auctionTimer = null, auctionTimeLeft = 6;
        const AUCTION_TIME = 6, MAX_TEMPLATES = 5;
        let templates = [], currentTemplateIndex = 0;
        const ROLE_ICONS = {'íƒ±ì»¤':'ğŸ›¡ï¸','ë”œëŸ¬':'âš”ï¸','íëŸ¬':'â¤ï¸','ëœë¤':'ğŸ²'};
        const ROLE_NAMES = {'íƒ±ì»¤':'íƒ±ì»¤','ë”œëŸ¬':'ë”œëŸ¬','íëŸ¬':'íëŸ¬','ëœë¤':'ëœë¤'};
        const STORAGE_KEY = 'teamBuilder_kr_v3';
        let roleEditSource = null; 

        function init() {
            loadTemplates(); updateTemplateButtons(); loadCurrentTemplate();
            updateTeamSlots(); updateSavedPlayersUI(); setupEventListeners();
            setupSpectatorsDragDrop(); updateTeamPoints(); setupScreenshotFeature();
        }

        function loadTemplates() {
            try { templates = JSON.parse(localStorage.getItem(STORAGE_KEY+'_templates')) || []; } catch(e) { templates = []; }
            while(templates.length < MAX_TEMPLATES) templates.push({name:`í…œí”Œë¦¿ ${templates.length+1}`,players:[],nextId:1});
            currentTemplateIndex = parseInt(localStorage.getItem(STORAGE_KEY+'_current')) || 0;
        }
        function saveTemplates() {
            localStorage.setItem(STORAGE_KEY+'_templates', JSON.stringify(templates));
            localStorage.setItem(STORAGE_KEY+'_current', currentTemplateIndex.toString());
        }
        function loadCurrentTemplate() {
            const t = templates[currentTemplateIndex];
            savedPlayers = t.players || []; nextPlayerId = t.nextId || 1;
        }
        function saveCurrentTemplate() {
            templates[currentTemplateIndex].players = savedPlayers;
            templates[currentTemplateIndex].nextId = nextPlayerId;
            saveTemplates();
        }
        function switchTemplate(i) {
            saveCurrentTemplate(); currentTemplateIndex = i; loadCurrentTemplate();
            updateTemplateButtons(); updateSavedPlayersUI(); clearAll(); saveTemplates();
        }
        function updateTemplateButtons() {
            const c = document.getElementById('templateButtons'); c.innerHTML = '';
            templates.forEach((t,i) => {
                const b = document.createElement('button');
                b.className = 'template-btn' + (i===currentTemplateIndex?' active':'');
                b.textContent = t.name;
                b.onclick = () => switchTemplate(i);
                c.appendChild(b);
            });
        }
        function openTemplateNameModal() {
            document.getElementById('templateNameInput').value = templates[currentTemplateIndex].name;
            document.getElementById('templateNameModal').classList.add('active');
            document.getElementById('templateNameInput').focus();
        }
        function saveTemplateName() {
            const n = document.getElementById('templateNameInput').value.trim();
            if(!n) return alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!');
            templates[currentTemplateIndex].name = n; saveTemplates(); updateTemplateButtons();
            document.getElementById('templateNameModal').classList.remove('active');
        }
        function updateTeamPoints() {
            document.getElementById('team1Points').textContent = team1Points+'P';
            document.getElementById('team2Points').textContent = team2Points+'P';
        }
        function getTierClass(t) {
            if(t<=1) return 'tier-bronze'; if(t<=2) return 'tier-silver';
            if(t<=3) return 'tier-gold'; if(t<=4) return 'tier-platinum'; return 'tier-diamond';
        }
        function getTeamPlayerNames() {
            const s = new Set();
            document.querySelectorAll('.team-slot .player-card').forEach(c => s.add(JSON.parse(c.dataset.player).name));
            return s;
        }
        function getSpectatorPlayerNames() {
            const s = new Set();
            document.querySelectorAll('#spectatorsGrid .spectator-card').forEach(c => s.add(JSON.parse(c.dataset.player).name));
            return s;
        }
        function getSpectatorPlayers() {
            const p = [];
            document.querySelectorAll('#spectatorsGrid .spectator-card').forEach(c => p.push(JSON.parse(c.dataset.player)));
            return p;
        }
        function calculateTeamSize() {
            const team1Count = document.querySelectorAll('#team1 .player-card').length;
            const team2Count = document.querySelectorAll('#team2 .player-card').length;
            const spectatorCount = document.querySelectorAll('#spectatorsGrid .spectator-card').length;
            const total = team1Count + team2Count + spectatorCount;
            return Math.max(5, Math.ceil(total / 2));
        }
        function getRoleCounts(p) {
            const c = {'íƒ±ì»¤':0,'ë”œëŸ¬':0,'íëŸ¬':0,'ëœë¤':0};
            p.forEach(x => c[x.role]++); return c;
        }

        function resetAllToSpectators() {
            const teamPlayers = [];
            document.querySelectorAll('.team-slot .player-card').forEach(c => {
                teamPlayers.push(JSON.parse(c.dataset.player));
            });
            if(teamPlayers.length === 0) return alert('íŒ€ì— ë°°ì¹˜ëœ ì¸ì›ì´ ì—†ìŠµë‹ˆë‹¤!');
            document.querySelectorAll('.team-slot').forEach(s => {
                s.innerHTML = ''; s.classList.add('empty');
            });
            teamPlayers.forEach(p => addToSpectators(p));
            updateSpectatorCount(); updateTeamScores(); updateSavedPlayersUI(); updateTeamSlots();
        }
        
        function addAllWaitlistToSpectator() {
            let count = 0;
            const existing = new Set([...getTeamPlayerNames(), ...getSpectatorPlayerNames()]);
            savedPlayers.forEach(p => {
                if(!existing.has(p.name)) {
                    addToSpectators(p);
                    count++;
                }
            });
            if(count > 0) {
                updateSpectatorCount(); updateSavedPlayersUI(); updateTeamSlots();
            } else {
                alert('ì¶”ê°€í•  ëŒ€ê¸°ìê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // íƒ€ì´ë¨¸
        function startAuctionTimer() {
            stopAuctionTimer(); auctionTimeLeft = AUCTION_TIME; updateTimerDisplay();
            auctionTimer = setInterval(() => {
                auctionTimeLeft--;
                updateTimerDisplay();
                // BGM ê¸´ì¥ê° ì—°ë™
                const tension = 1 - (auctionTimeLeft / AUCTION_TIME);
                setBGMTension(tension);
                if (auctionTimeLeft <= 3 && auctionTimeLeft > 0) {
                    playTimerWarningSound();
                    if (auctionTimeLeft <= 3) speak(`${auctionTimeLeft}!`, 1.5, 0.4);
                }
                if (auctionTimeLeft <= 0) { stopAuctionTimer(); playTimerEndSound(); }
            }, 1000);
        }
        function stopAuctionTimer() { if(auctionTimer) { clearInterval(auctionTimer); auctionTimer = null; } }
        function resetAuctionTimer() { startAuctionTimer(); }
        function updateTimerDisplay() {
            const ts = document.getElementById('timerSeconds'), tp = document.getElementById('timerProgress');
            ts.textContent = auctionTimeLeft;
            const circ = 2 * Math.PI * 50, off = circ * (1 - auctionTimeLeft / AUCTION_TIME);
            tp.style.strokeDashoffset = off;
            if(auctionTimeLeft <= 3) { ts.classList.add('warning'); tp.classList.add('warning'); }
            else { ts.classList.remove('warning'); tp.classList.remove('warning'); }
        }

        function showSpecialEffect(t) {
            const e = document.createElement('div'); e.className = 'special-effect'; e.textContent = t;
            document.body.appendChild(e); setTimeout(() => e.remove(), 1500);
        }

        // ë“œë˜ê·¸ì•¤ë“œë¡­
        function setupSpectatorsDragDrop() {
            const g = document.getElementById('spectatorsGrid');
            g.addEventListener('dragover', e => { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; });
            g.addEventListener('dragenter', e => e.currentTarget.classList.add('drag-over'));
            g.addEventListener('dragleave', e => { if(e.target === e.currentTarget) e.currentTarget.classList.remove('drag-over'); });
            g.addEventListener('drop', e => {
                e.stopPropagation(); e.preventDefault(); g.classList.remove('drag-over');
                if(!draggedElement || !sourceContainer) return;
                const p = JSON.parse(draggedElement.dataset.player);
                if(sourceContainer.classList.contains('team-slot')) {
                    sourceContainer.innerHTML = ''; sourceContainer.classList.add('empty');
                    addToSpectators(p); updateTeamScores(); updateSpectatorCount(); updateSavedPlayersUI(); updateTeamSlots();
                }
            });
        }

        function addToSpectators(p) {
            const g = document.getElementById('spectatorsGrid');
            if(getSpectatorPlayerNames().has(p.name)) return;
            g.classList.remove('empty'); 
            const currentSpecs = getSpectatorPlayers();
            currentSpecs.push(p);
            currentSpecs.sort((a,b) => a.name.localeCompare(b.name, 'ko'));
            g.innerHTML = '';
            currentSpecs.forEach(sp => g.appendChild(createSpectatorCard(sp)));
        }
        
        function createSpectatorCard(p) {
            const c = document.createElement('div'); c.className = 'spectator-card';
            c.innerHTML = `<button class="remove-spectator-btn">âœ•</button><div class="spectator-name">${p.name}</div><div class="spectator-meta"><span class="spectator-tier">${p.tier}ì </span><span class="spectator-role">${ROLE_ICONS[p.role]} ${ROLE_NAMES[p.role]}</span></div>`;
            c.draggable = true; c.dataset.player = JSON.stringify(p);
            c.addEventListener('dragstart', handleDragStart); c.addEventListener('dragend', handleDragEnd);
            c.querySelector('.remove-spectator-btn').onclick = e => { e.stopPropagation(); removeFromSpectators(p); };
            c.querySelector('.spectator-role').onclick = e => { e.stopPropagation(); openRoleModal(p, 'spectator'); };
            c.querySelector('.spectator-tier').style.cursor = 'pointer';
            c.querySelector('.spectator-tier').onclick = e => { e.stopPropagation(); openTierModal(p); };
            return c;
        }
        function openRoleModal(p, source) {
            roleEditSource = source;
            if(source === 'spectator') editingSpectatorId = p.id;
            else editingTeamPlayerId = p.id;
            selectedRole = p.role;
            document.getElementById('roleModalTitle').textContent = p.name + ' - ì—­í•  ì„ íƒ';
            document.querySelectorAll('.role-option').forEach(o => { o.classList.toggle('selected', o.dataset.role === p.role); });
            document.getElementById('roleModal').classList.add('active');
        }
        function saveRoleChange() {
            if(!selectedRole) return alert('ì—­í• ì„ ì„ íƒí•˜ì„¸ìš”!');
            if(roleEditSource === 'spectator') {
                document.querySelectorAll('#spectatorsGrid .spectator-card').forEach(c => {
                    const p = JSON.parse(c.dataset.player);
                    if(p.id === editingSpectatorId) {
                        p.role = selectedRole; c.dataset.player = JSON.stringify(p);
                        c.querySelector('.spectator-role').innerHTML = ROLE_ICONS[p.role]+' '+ROLE_NAMES[p.role];
                    }
                });
            } else {
                document.querySelectorAll('.team-slot .player-card').forEach(c => {
                    const p = JSON.parse(c.dataset.player);
                    if(p.id === editingTeamPlayerId) {
                        p.role = selectedRole; c.dataset.player = JSON.stringify(p);
                        c.querySelector('.player-role-icon').textContent = ROLE_ICONS[p.role];
                        c.querySelector('.role-badge').textContent = ROLE_NAMES[p.role];
                    }
                });
            }
            document.getElementById('roleModal').classList.remove('active');
            editingSpectatorId = null; editingTeamPlayerId = null; selectedRole = null; roleEditSource = null;
        }
        function removeFromSpectators(p) {
            document.querySelectorAll('#spectatorsGrid .spectator-card').forEach(c => {
                if(JSON.parse(c.dataset.player).id === p.id) c.remove();
            });
            updateSpectatorCount(); updateSavedPlayersUI(); updateTeamSlots();
        }
        function updateSpectatorCount() {
            const g = document.getElementById('spectatorsGrid');
            const n = g.querySelectorAll('.spectator-card').length;
            document.getElementById('spectatorCount').textContent = n + 'ëª…';
            g.classList.toggle('empty', n === 0);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        function setupEventListeners() {
            document.getElementById('addPlayerBtn').onclick = addPlayer;
            document.getElementById('newPlayerInput').onkeypress = e => { if(e.key==='Enter') addPlayer(); };
            document.getElementById('newTierInput').onkeypress = e => { if(e.key==='Enter') addPlayer(); };
            document.getElementById('balancedBtn').onclick = balancedRandomAssign;
            document.getElementById('spectatorRandomBtn').onclick = spectatorRandomAssign;
            document.getElementById('auctionBtn').onclick = startAuction;
            document.getElementById('resetToSpectatorBtn').onclick = resetAllToSpectators;
            document.getElementById('addAllToSpectatorBtn').onclick = addAllWaitlistToSpectator;
            document.getElementById('clearTeamsBtn').onclick = clearAll;
            document.getElementById('team1BidBtn').onclick = () => placeBid(1);
            document.getElementById('team2BidBtn').onclick = () => placeBid(2);
            document.getElementById('auctionPassBtn').onclick = passAuction;
            document.getElementById('auctionNextBtn').onclick = nextAuctionPlayer;
            document.getElementById('auctionCloseBtn').onclick = closeAuction;
            document.getElementById('team1BidInput').onkeypress = e => { if(e.key==='Enter') placeBid(1); };
            document.getElementById('team2BidInput').onkeypress = e => { if(e.key==='Enter') placeBid(2); };
            document.getElementById('tierModalCancel').onclick = () => { document.getElementById('tierModal').classList.remove('active'); };
            document.getElementById('tierModalSave').onclick = saveTierChange;
            document.getElementById('tierModalInput').onkeypress = e => { if(e.key==='Enter') saveTierChange(); };
            document.querySelectorAll('.role-option').forEach(o => {
                o.onclick = function() {
                    document.querySelectorAll('.role-option').forEach(x => x.classList.remove('selected'));
                    this.classList.add('selected'); selectedRole = this.dataset.role;
                };
            });
            document.getElementById('roleModalCancel').onclick = () => { document.getElementById('roleModal').classList.remove('active'); };
            document.getElementById('roleModalSave').onclick = saveRoleChange;
            document.getElementById('saveTemplateBtn').onclick = () => { saveCurrentTemplate(); playClickSound(); alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!'); };
            document.getElementById('renameTemplateBtn').onclick = openTemplateNameModal;
            document.getElementById('templateNameCancel').onclick = () => { document.getElementById('templateNameModal').classList.remove('active'); };
            document.getElementById('templateNameSave').onclick = saveTemplateName;
            document.getElementById('templateNameInput').onkeypress = e => { if(e.key==='Enter') saveTemplateName(); };

            const handleAuctionTab = (e, targetId) => {
                if (e.key === 'Tab') {
                    e.preventDefault(); 
                    const target = document.getElementById(targetId);
                    target.focus();
                    target.select(); 
                }
            };
            document.getElementById('team1BidInput').addEventListener('keydown', (e) => handleAuctionTab(e, 'team2BidInput'));
            document.getElementById('team2BidInput').addEventListener('keydown', (e) => handleAuctionTab(e, 'team1BidInput'));

            document.addEventListener('keydown', (e) => {
                if(document.getElementById('auctionModal').classList.contains('active')) {
                    if(e.key === 'F1') { e.preventDefault(); nextAuctionPlayer(); }
                    if(e.key === 'F2') { e.preventDefault(); passAuction(); }
                }
            });
        }

        // í”Œë ˆì´ì–´ ê´€ë¦¬
        function addPlayer() {
            const name = document.getElementById('newPlayerInput').value.trim();
            const tier = parseInt(document.getElementById('newTierInput').value)||3;
            if(!name) return alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!');
            savedPlayers.push({id:nextPlayerId++, name, tier, role:'ëœë¤'});
            saveCurrentTemplate();
            document.getElementById('newPlayerInput').value = '';
            document.getElementById('newTierInput').value = '3';
            updateSavedPlayersUI();
            playClickSound();
        }
        function removePlayer(id) {
            const p = savedPlayers.find(x => x.id===id);
            if(!p || !confirm('"'+p.name+'" ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            savedPlayers = savedPlayers.filter(x => x.id!==id);
            document.querySelectorAll('.spectator-card').forEach(c => { if(JSON.parse(c.dataset.player).id===id) c.remove(); });
            document.querySelectorAll('.team-slot').forEach(s => {
                const c = s.querySelector('.player-card');
                if(c && JSON.parse(c.dataset.player).id===id) { s.innerHTML=''; s.classList.add('empty'); }
            });
            saveCurrentTemplate(); updateSavedPlayersUI(); updateSpectatorCount(); updateTeamScores(); updateTeamSlots();
        }
        function openTierModal(p) {
            editingPlayerId = p.id;
            document.getElementById('tierModalInput').value = p.tier;
            document.getElementById('tierModal').classList.add('active');
            document.getElementById('tierModalInput').focus();
        }
        function saveTierChange() {
            const t = parseInt(document.getElementById('tierModalInput').value);
            if(isNaN(t)||t<1) return alert('í‹°ì–´ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤!');
            const p = savedPlayers.find(x => x.id===editingPlayerId);
            if(p) { p.tier = t; saveCurrentTemplate(); updatePlayerCardsEverywhere(p); updateSavedPlayersUI(); updateTeamScores(); }
            document.getElementById('tierModal').classList.remove('active');
        }
        function updatePlayerCardsEverywhere(p) {
            document.querySelectorAll('.spectator-card').forEach(c => {
                const cp = JSON.parse(c.dataset.player);
                if(cp.id===p.id) { cp.tier=p.tier; c.dataset.player=JSON.stringify(cp); c.querySelector('.spectator-tier').textContent=p.tier+'ì '; }
            });
            document.querySelectorAll('.player-card').forEach(c => {
                const cp = JSON.parse(c.dataset.player);
                if(cp.id===p.id) {
                    cp.tier=p.tier; c.dataset.player=JSON.stringify(cp);
                    const tb = c.querySelector('.tier-badge'); tb.textContent=p.tier+'ì '; tb.className='tier-badge '+getTierClass(p.tier);
                }
            });
        }
        function selectPlayer(p) {
            if(getTeamPlayerNames().has(p.name)) return alert(p.name+'ì€(ëŠ”) ì´ë¯¸ íŒ€ì— ìˆìŠµë‹ˆë‹¤!');
            if(getSpectatorPlayerNames().has(p.name)) return alert(p.name+'ì€(ëŠ”) ì´ë¯¸ ê´€ì „ìì…ë‹ˆë‹¤!');
            addToSpectators(p); updateSpectatorCount(); updateSavedPlayersUI(); updateTeamSlots();
            playClickSound();
        }
        function updateSavedPlayersUI() {
            const c = document.getElementById('savedPlayers'); c.innerHTML = '';
            if(savedPlayers.length===0) { c.innerHTML='<span style="color:rgba(255,255,255,0.2)">ì €ì¥ëœ ì°¸ê°€ì ì—†ìŒ</span>'; return; }
            const teamN = getTeamPlayerNames(), specN = getSpectatorPlayerNames();
            [...savedPlayers].sort((a,b)=>a.name.localeCompare(b.name,'ko')).forEach(p => {
                const t = document.createElement('div'); t.className = 'saved-player-tag';
                if(teamN.has(p.name)) t.classList.add('in-team');
                else if(specN.has(p.name)) t.classList.add('in-spectator');
                else { t.classList.add('selectable'); t.onclick = () => selectPlayer(p); }
                t.innerHTML = `<span>${p.name}</span><span class="tier-badge-small">${p.tier}</span><button class="remove-btn">âœ•</button>`;
                t.querySelector('.tier-badge-small').onclick = e => { e.stopPropagation(); openTierModal(p); };
                t.querySelector('.remove-btn').onclick = e => { e.stopPropagation(); removePlayer(p.id); };
                c.appendChild(t);
            });
        }

        function updateTeamSlots() {
            const size = calculateTeamSize();
            const t1 = document.getElementById('team1'), t2 = document.getElementById('team2');
            const p1=[], p2=[];
            t1.querySelectorAll('.player-card').forEach(c => p1.push(JSON.parse(c.dataset.player)));
            t2.querySelectorAll('.player-card').forEach(c => p2.push(JSON.parse(c.dataset.player)));
            t1.innerHTML=''; t2.innerHTML='';
            for(let i=0; i<size; i++) {
                const s1 = createSlot('team1',i), s2 = createSlot('team2',i);
                if(i<p1.length) { s1.innerHTML=''; s1.classList.remove('empty'); s1.appendChild(createPlayerCard(p1[i], i===0)); }
                if(i<p2.length) { s2.innerHTML=''; s2.classList.remove('empty'); s2.appendChild(createPlayerCard(p2[i], i===0)); }
                t1.appendChild(s1); t2.appendChild(s2);
            }
            updateTeamScores();
        }
        function createSlot(tid, idx) {
            const s = document.createElement('div'); s.className = 'team-slot empty';
            s.dataset.team = tid; s.dataset.index = idx;
            s.addEventListener('dragover', e => { e.preventDefault(); e.dataTransfer.dropEffect='move'; });
            s.addEventListener('dragenter', e => e.currentTarget.classList.add('drag-over'));
            s.addEventListener('dragleave', e => e.currentTarget.classList.remove('drag-over'));
            s.addEventListener('drop', handleDrop);
            return s;
        }
        function createPlayerCard(p, isLeader = false) {
            const c = document.createElement('div'); 
            c.className = 'player-card' + (isLeader ? ' is-leader' : '');
            c.innerHTML = `<div class="player-card-content"><div class="player-role-icon">${ROLE_ICONS[p.role]}</div><div class="player-info"><div class="player-name">${p.name}${isLeader ? ' <span class="leader-badge">íŒ€ì¥</span>' : ''}</div><div class="player-meta"><span class="tier-badge ${getTierClass(p.tier)}">${p.tier}ì </span><span class="role-badge">${ROLE_NAMES[p.role]}</span></div></div></div>`;
            c.draggable = true; c.dataset.player = JSON.stringify(p);
            c.addEventListener('dragstart', handleDragStart); c.addEventListener('dragend', handleDragEnd);
            c.querySelector('.player-role-icon').onclick = e => { e.stopPropagation(); openRoleModal(p, 'team'); };
            return c;
        }
        function handleDragStart(e) {
            draggedElement = e.target; sourceContainer = e.target.parentElement;
            e.target.classList.add('dragging'); e.dataTransfer.effectAllowed = 'move';
        }
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.team-slot').forEach(s => s.classList.remove('drag-over'));
            document.getElementById('spectatorsGrid').classList.remove('drag-over');
            updateTeamScores(); updateSpectatorCount(); updateSavedPlayersUI();
        }
        function handleDrop(e) {
            e.stopPropagation(); e.preventDefault();
            const ts = e.currentTarget; ts.classList.remove('drag-over');
            if(!draggedElement || !sourceContainer || sourceContainer===ts) return;
            const p = JSON.parse(draggedElement.dataset.player), ex = ts.querySelector('.player-card');
            const targetIndex = parseInt(ts.dataset.index);
            const isLeader = targetIndex === 0;
            
            if(ex) {
                const ep = JSON.parse(ex.dataset.player);
                ts.innerHTML=''; ts.classList.remove('empty');
                if(sourceContainer.classList.contains('team-slot')) {
                    const srcIndex = parseInt(sourceContainer.dataset.index);
                    const srcIsLeader = srcIndex === 0;
                    sourceContainer.innerHTML=''; sourceContainer.classList.remove('empty');
                    sourceContainer.appendChild(createPlayerCard(ep, srcIsLeader));
                } else { draggedElement.remove(); addToSpectators(ep); }
                ts.appendChild(createPlayerCard(p, isLeader));
            } else {
                if(sourceContainer.classList.contains('team-slot')) { sourceContainer.innerHTML=''; sourceContainer.classList.add('empty'); }
                else { draggedElement.remove(); }
                ts.innerHTML=''; ts.classList.remove('empty'); ts.appendChild(createPlayerCard(p, isLeader));
            }
            updateTeamScores(); updateSpectatorCount(); updateSavedPlayersUI();
        }
        function updateTeamScores() {
            let s1=0, s2=0;
            document.querySelectorAll('#team1 .player-card').forEach(c => s1+=JSON.parse(c.dataset.player).tier);
            document.querySelectorAll('#team2 .player-card').forEach(c => s2+=JSON.parse(c.dataset.player).tier);
            document.getElementById('team1Score').textContent = s1+'ì ';
            document.getElementById('team2Score').textContent = s2+'ì ';
            const d = Math.abs(s1-s2), de = document.getElementById('scoreDiff');
            de.textContent = 'ì ìˆ˜ì°¨: '+d;
            de.classList.toggle('balanced', d<=1);
        }

        // íŒ€ì¥ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
        function getTeamLeaderName(teamNum) {
            const firstSlot = document.querySelector(`#team${teamNum} .team-slot:first-child .player-card`);
            if (firstSlot) {
                return JSON.parse(firstSlot.dataset.player).name;
            }
            return '-';
        }

        function balancedRandomAssign() {
            const sp = getSpectatorPlayers();
            if(sp.length<2) return alert('ê´€ì „ìê°€ 2ëª… ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤!');
            clearTeams(); updateTeamSlots();
            const size = calculateTeamSize(), max = size*2;
            const assign = sp.slice(0,Math.min(sp.length,max)), remain = sp.slice(max);
            let best=null, bestScore=Infinity;
            for(let i=0; i<10000; i++) {
                const sh = [...assign].sort(()=>Math.random()-0.5);
                const t1=sh.slice(0,size), t2=sh.slice(size,size*2);
                const d = Math.abs(t1.reduce((s,p)=>s+p.tier,0) - t2.reduce((s,p)=>s+p.tier,0));
                const r1=getRoleCounts(t1), r2=getRoleCounts(t2);
                let rd=0; Object.keys(r1).forEach(k => rd+=Math.abs(r1[k]-r2[k]));
                const score = d + rd*10;
                if(score < bestScore) { bestScore=score; best=sh; if(score===0) break; }
            }
            if(best) {
                assignPlayersToTeams(best, size);
                const g = document.getElementById('spectatorsGrid'); g.innerHTML='';
                remain.forEach(p => addToSpectators(p));
                updateSpectatorCount(); updateSavedPlayersUI();
                playSuccessSound();
                if(bestScore===0) setTimeout(()=>showSpecialEffect('ğŸ¯ ì™„ë²½í•œ ë°¸ëŸ°ìŠ¤!'),100);
            }
        }
        function spectatorRandomAssign() {
            const sp = getSpectatorPlayers();
            if(sp.length===0) return alert('ê´€ì „ìê°€ ì—†ìŠµë‹ˆë‹¤!');
            let empty=0;
            document.querySelectorAll('.team-slot').forEach(s => { if(!s.querySelector('.player-card')) empty++; });
            if(empty===0) return alert('ë¹ˆ ìŠ¬ë¡¯ì´ ì—†ìŠµë‹ˆë‹¤!');
            const t1c=[], t2c=[];
            document.querySelectorAll('#team1 .player-card').forEach(c => t1c.push(JSON.parse(c.dataset.player)));
            document.querySelectorAll('#team2 .player-card').forEach(c => t2c.push(JSON.parse(c.dataset.player)));
            const size = calculateTeamSize(), toAssign = Math.min(sp.length, empty);
            let best=null, bestScore=Infinity;
            for(let i=0; i<10000; i++) {
                const sh = [...sp].sort(()=>Math.random()-0.5).slice(0,toAssign);
                let t1=[...t1c], t2=[...t2c];
                sh.forEach(p => { if(t1.length<size) t1.push(p); else if(t2.length<size) t2.push(p); });
                const d = Math.abs(t1.reduce((s,p)=>s+p.tier,0) - t2.reduce((s,p)=>s+p.tier,0));
                const r1=getRoleCounts(t1), r2=getRoleCounts(t2);
                let rd=0; Object.keys(r1).forEach(k => rd+=Math.abs(r1[k]-r2[k]));
                const score = d + rd*10;
                if(score < bestScore) { bestScore=score; best=sh; if(score===0) break; }
            }
            if(best) {
                let idx=0;
                document.querySelectorAll('#team1 .team-slot').forEach((s,i) => {
                    if(!s.querySelector('.player-card') && idx<best.length) {
                        s.innerHTML=''; s.classList.remove('empty'); s.appendChild(createPlayerCard(best[idx++], i===0));
                    }
                });
                document.querySelectorAll('#team2 .team-slot').forEach((s,i) => {
                    if(!s.querySelector('.player-card') && idx<best.length) {
                        s.innerHTML=''; s.classList.remove('empty'); s.appendChild(createPlayerCard(best[idx++], i===0));
                    }
                });
                const g = document.getElementById('spectatorsGrid'); g.innerHTML='';
                sp.slice(idx).forEach(p => addToSpectators(p));
                updateSpectatorCount(); updateTeamScores(); updateSavedPlayersUI();
                playSuccessSound();
            }
        }

        function startAuction() {
            const sp = getSpectatorPlayers();
            if(sp.length<2) return alert('ê´€ì „ìê°€ 2ëª… ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤!');
            updateTeamSlots();
            auctionPlayers = [...sp].sort(()=>Math.random()-0.5);
            currentAuctionIndex = 0; currentBid = {team:null, amount:0}; bidHistory = [];
            team1Points = 100; team2Points = 100; updateTeamPoints();
            playAuctionStartSound();
            setTimeout(() => shout('ê²½ë§¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤!'), 1200);
            setTimeout(() => startBGM(), 1800);
            showAuctionModal();
        }
        function showAuctionModal() {
            if(currentAuctionIndex >= auctionPlayers.length) { alert('ëª¨ë“  ê²½ë§¤ê°€ ëë‚¬ìŠµë‹ˆë‹¤!'); closeAuction(); return; }
            const p = auctionPlayers[currentAuctionIndex];
            
            // íŒ€ì¥ ì´ë¦„ í‘œì‹œ: 1íŒ€(íŒ€ì¥ì´ë¦„) í˜•íƒœ
            const leader1 = getTeamLeaderName(1);
            const leader2 = getTeamLeaderName(2);
            document.getElementById('auctionLeader1Name').textContent = leader1 !== '-' ? leader1 : '';
            document.getElementById('auctionLeader1Wrap').style.display = leader1 !== '-' ? '' : 'none';
            document.getElementById('auctionLeader2Name').textContent = leader2 !== '-' ? leader2 : '';
            document.getElementById('auctionLeader2Wrap').style.display = leader2 !== '-' ? '' : 'none';
            
            document.getElementById('auctionPlayerIcon').textContent = ROLE_ICONS[p.role];
            document.getElementById('auctionPlayerName').textContent = p.name;
            document.getElementById('auctionPlayerTier').textContent = p.tier+'ì ';
            document.getElementById('auctionPlayerRole').textContent = ROLE_ICONS[p.role]+' '+ROLE_NAMES[p.role];
            document.getElementById('auctionTeam1Points').textContent = team1Points;
            document.getElementById('auctionTeam2Points').textContent = team2Points;
            document.getElementById('team1BidInput').value = '';
            document.getElementById('team2BidInput').value = '';
            currentBid = {team:null, amount:0}; bidHistory = [];
            updateCurrentBidDisplay(); updateBidHistory(); updateLeadingTeam(); updateRemainingPlayers();
            document.getElementById('team1BidBtn').disabled = team1Points===0;
            document.getElementById('team2BidBtn').disabled = team2Points===0;
            document.getElementById('auctionModal').classList.add('active');
            
            // ğŸ™ï¸ ì„ ìˆ˜ ë“±ì¥ ìŒì„± + ë“œëŸ¼ë¡¤
            playNewPlayerSound();
            const remaining = auctionPlayers.length - currentAuctionIndex;
            const order = currentAuctionIndex + 1;
            setTimeout(() => {
                shout(`${order}ë²ˆì§¸ ì„ ìˆ˜! ${p.name}! ${p.tier}ì ! ì…ì°° ì‹œì‘!`);
            }, 500);
            
            startAuctionTimer();
            setTimeout(() => document.getElementById('team1BidInput').focus(), 100);
        }
        function updateRemainingPlayers() {
            const g = document.getElementById('remainingGrid'); g.innerHTML = '';
            document.getElementById('remainingCount').textContent = (auctionPlayers.length - currentAuctionIndex) + 'ëª…';
            auctionPlayers.forEach((p,i) => {
                if(i >= currentAuctionIndex) {
                    const d = document.createElement('div');
                    d.className = 'remaining-player' + (i===currentAuctionIndex?' current':'');
                    d.innerHTML = `${ROLE_ICONS[p.role]} ${p.name} (${p.tier}ì )`;
                    g.appendChild(d);
                }
            });
        }
        function updateCurrentBidDisplay() {
            const v = document.getElementById('currentBidValue');
            if(currentBid.team===null) { v.textContent='ì…ì°° ì—†ìŒ'; v.className='current-bid-value none'; }
            else { v.textContent=currentBid.team+'íŒ€ - '+currentBid.amount+'P'; v.className='current-bid-value team-'+currentBid.team; }
        }
        function updateLeadingTeam() {
            const b1 = document.getElementById('auctionTeamBox1'), b2 = document.getElementById('auctionTeamBox2');
            b1.classList.remove('leading'); b2.classList.remove('leading');
            if(currentBid.team===1) b1.classList.add('leading');
            else if(currentBid.team===2) b2.classList.add('leading');
        }
        function updateBidHistory() {
            const l = document.getElementById('bidHistoryList'); l.innerHTML = '';
            bidHistory.slice(-5).reverse().forEach(b => {
                const d = document.createElement('div');
                d.className = 'bid-history-item team-'+b.team;
                d.textContent = b.team+'íŒ€: '+b.amount+'P';
                l.appendChild(d);
            });
        }
        function quickBid(team, inc) {
            const inp = document.getElementById('team'+team+'BidInput');
            const min = currentBid.amount + 1;
            inp.value = Math.max(min, (parseInt(inp.value)||min) + inc);
            playClickSound();
        }
        function allInBid(team) {
            document.getElementById('team'+team+'BidInput').value = team===1 ? team1Points : team2Points;
            playAllInSound();
        }
        function placeBid(team) {
            const amt = parseInt(document.getElementById('team'+team+'BidInput').value);
            const pts = team===1 ? team1Points : team2Points;
            if(isNaN(amt)||amt<0) return alert('ì˜¬ë°”ë¥¸ ì…ì°°ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
            if(amt > pts) return alert('í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!');
            if(amt <= currentBid.amount) return alert(currentBid.amount+'P ë³´ë‹¤ ë†’ì•„ì•¼ í•©ë‹ˆë‹¤!');
            
            playBidSound();
            
            // ì˜¬ì¸ ì²´í¬
            const isAllIn = amt === pts;
            if(isAllIn) {
                playAllInSound();
                showSpecialEffect('ğŸ’¥ ì˜¬ì¸!');
                setTimeout(() => shout(`${team}íŒ€! ì˜¬ì¸! ${amt}í¬ì¸íŠ¸!`), 200);
            } else if(currentBid.amount>0 && amt===currentBid.amount+1) {
                showSpecialEffect('âš¡ í¼í™íŠ¸ ì…ì°°!');
                shout(`${team}íŒ€! ${amt}!`);
            } else if(auctionTimeLeft<=2) {
                showSpecialEffect('ğŸ”¥ ë§‰íŒ ì…ì°°!');
                shout(`ë§‰íŒ ë’¤ì§‘ê¸°! ${team}íŒ€! ${amt}!`);
            } else {
                speak(`${team}íŒ€, ${amt}!`, 1.3, 0.6);
            }
            
            currentBid = {team, amount:amt}; bidHistory.push({team, amount:amt});
            updateCurrentBidDisplay(); updateLeadingTeam(); updateBidHistory(); resetAuctionTimer();
            
            const opp = team===1 ? 'team2BidInput' : 'team1BidInput';
            const targetInput = document.getElementById(opp);
            targetInput.focus();
            targetInput.select();
        }
        function passAuction() {
            if(currentBid.team!==null) return alert('ì…ì°°ì´ ìˆì–´ì„œ ìœ ì°°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
            playPassSound();
            const passed = auctionPlayers[currentAuctionIndex];
            speak(`${passed.name}, ìœ ì°°!`, 1.0, 0.5);
            auctionPlayers.splice(currentAuctionIndex, 1);
            auctionPlayers.push(passed);
            resetAuctionTimer();
            if(currentAuctionIndex < auctionPlayers.length) { currentBid={team:null,amount:0}; bidHistory=[]; showAuctionModal(); }
            else { alert('ëª¨ë“  ê²½ë§¤ê°€ ëë‚¬ìŠµë‹ˆë‹¤!'); closeAuction(); }
        }
        function nextAuctionPlayer() {
            if(currentBid.team===null) {
                if(team1Points===0 && team2Points>0) currentBid={team:2,amount:0};
                else if(team2Points===0 && team1Points>0) currentBid={team:1,amount:0};
                else return alert('ì•„ì§ ì…ì°°ì´ ì—†ìŠµë‹ˆë‹¤!');
            }
            playSuccessSound();
            const p = auctionPlayers[currentAuctionIndex];
            
            // ğŸ™ï¸ ë‚™ì°° ìŒì„±
            if(currentBid.amount > 0) {
                shout(`ë‚™ì°°! ${p.name}! ${currentBid.team}íŒ€! ${currentBid.amount}í¬ì¸íŠ¸!`);
            } else {
                shout(`${p.name}! ${currentBid.team}íŒ€ ë°°ì •!`);
            }
            
            if(currentBid.team===1) team1Points -= currentBid.amount;
            else team2Points -= currentBid.amount;
            updateTeamPoints();
            addPlayerToTeam(p, currentBid.team); removeFromSpectators(p);
            currentAuctionIndex++;
            resetAuctionTimer();
            if(currentAuctionIndex < auctionPlayers.length) {
                if(team1Points===0 || team2Points===0) { stopAuctionTimer(); autoAssignRemaining(); }
                else setTimeout(() => showAuctionModal(), 1500); // ë‚™ì°° í›„ ì ì‹œ ì—¬ìœ 
            } else { stopAuctionTimer(); stopBGM(); playCompleteSound(); showSpecialEffect('ğŸ‰ ê²½ë§¤ ì™„ë£Œ!'); setTimeout(() => shout('ê²½ë§¤ê°€ ëª¨ë‘ ëë‚¬ìŠµë‹ˆë‹¤! ì¢‹ì€ ê²½ê¸° ë˜ì„¸ìš”!'), 500); setTimeout(closeAuction, 3000); }
        }
        function autoAssignRemaining() {
            const remain = auctionPlayers.slice(currentAuctionIndex);
            const target = team1Points===0 ? 2 : 1;
            remain.forEach(p => { addPlayerToTeam(p, target); removeFromSpectators(p); });
            playCompleteSound();
            stopBGM();
            showSpecialEffect('ğŸ‰ ë‚¨ì€ ì„ ìˆ˜ â†’ '+target+'íŒ€');
            shout(`ë‚¨ì€ ì„ ìˆ˜ ì „ì›! ${target}íŒ€ ë°°ì •! ê²½ë§¤ ì¢…ë£Œ!`);
            setTimeout(closeAuction, 2000);
        }
        function addPlayerToTeam(p, team) {
            const slots = document.querySelectorAll('#team'+team+' .team-slot');
            let slotIndex = 0;
            for(let s of slots) {
                if(!s.querySelector('.player-card')) {
                    s.innerHTML=''; s.classList.remove('empty'); 
                    s.appendChild(createPlayerCard(p, slotIndex===0)); 
                    break;
                }
                slotIndex++;
            }
            updateTeamScores(); updateSavedPlayersUI();
        }
        function closeAuction() {
            stopAuctionTimer(); stopBGM();
            speechSynthesis.cancel();
            document.getElementById('auctionModal').classList.remove('active');
        }
        function assignPlayersToTeams(players, size) {
            const t1 = document.querySelectorAll('#team1 .team-slot');
            const t2 = document.querySelectorAll('#team2 .team-slot');
            let idx = 0;
            for(let i=0; i<size && idx<players.length; i++) {
                t1[i].innerHTML=''; t1[i].classList.remove('empty'); t1[i].appendChild(createPlayerCard(players[idx++], i===0));
            }
            for(let i=0; i<size && idx<players.length; i++) {
                t2[i].innerHTML=''; t2[i].classList.remove('empty'); t2[i].appendChild(createPlayerCard(players[idx++], i===0));
            }
            updateTeamScores();
        }
        function clearTeams() {
            document.querySelectorAll('.team-slot').forEach(s => { s.innerHTML=''; s.classList.add('empty'); });
            updateTeamScores();
        }
        function clearAll() {
            clearTeams();
            document.getElementById('spectatorsGrid').innerHTML = '';
            team1Points = 100; team2Points = 100; updateTeamPoints();
            updateSpectatorCount(); updateSavedPlayersUI(); updateTeamSlots();
        }

        // ============================================================
        // ğŸ“¸ ìŠ¤í¬ë¦°ìƒ· ì°¸ê°€ì ì¶”ì¶œ ê¸°ëŠ¥
        // ============================================================
        function setupScreenshotFeature() {
            const section = document.getElementById('screenshotSection');
            const uploadArea = document.getElementById('screenshotUploadArea');
            const fileInput = document.getElementById('screenshotFileInput');
            const applyBtn = document.getElementById('screenshotApplyBtn');
            const cancelBtn = document.getElementById('screenshotCancelBtn');

            // í´ë¦­ìœ¼ë¡œ íŒŒì¼ ì„ íƒ
            uploadArea.onclick = () => fileInput.click();
            fileInput.onchange = (e) => {
                if (e.target.files[0]) processScreenshot(e.target.files[0]);
            };

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­
            section.addEventListener('dragover', (e) => {
                e.preventDefault();
                section.classList.add('drag-highlight');
            });
            section.addEventListener('dragleave', (e) => {
                if (e.target === section || !section.contains(e.relatedTarget)) {
                    section.classList.remove('drag-highlight');
                }
            });
            section.addEventListener('drop', (e) => {
                e.preventDefault();
                section.classList.remove('drag-highlight');
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    processScreenshot(file);
                }
            });

            // Ctrl+V ë¶™ì—¬ë„£ê¸° (ì „ì—­)
            document.addEventListener('paste', (e) => {
                // ëª¨ë‹¬ì´ë‚˜ ê²½ë§¤ ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ë¬´ì‹œ
                if (document.getElementById('auctionModal').classList.contains('active')) return;
                if (document.querySelector('.modal.active')) return;
                // input/textareaì— í¬ì»¤ìŠ¤ê°€ ìˆìœ¼ë©´ ë¬´ì‹œ (ìŠ¤í¬ë¦°ìƒ· textarea ì œì™¸)
                const active = document.activeElement;
                if (active && (active.tagName === 'INPUT' || (active.tagName === 'TEXTAREA' && active.id !== 'screenshotNames'))) return;

                const items = e.clipboardData.items;
                for (let item of items) {
                    if (item.type.startsWith('image/')) {
                        e.preventDefault();
                        const file = item.getAsFile();
                        processScreenshot(file);
                        break;
                    }
                }
            });

            applyBtn.onclick = applyScreenshotNames;
            cancelBtn.onclick = cancelScreenshot;
        }

        function processScreenshot(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const imgData = e.target.result;
                document.getElementById('screenshotImg').src = imgData;

                // ì—…ë¡œë“œ ì˜ì—­ ìˆ¨ê¸°ê³  ë¡œë”© í‘œì‹œ
                document.getElementById('screenshotUploadArea').style.display = 'none';
                document.getElementById('screenshotLoading').classList.add('active');
                document.getElementById('screenshotPreview').classList.remove('active');

                // OCR ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” ì´ë¯¸ì§€ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ê¸° ì–´ë ¤ìš°ë¯€ë¡œ
                // ì‚¬ìš©ìê°€ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” í…ìŠ¤íŠ¸ ì˜ì—­ì„ ì œê³µ)
                performOCR(imgData);
            };
            reader.readAsDataURL(file);
        }

        async function performOCR(imgData) {
            try {
                // Tesseract.js ë™ì  ë¡œë“œ
                if (!window.Tesseract) {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js';
                    document.head.appendChild(script);
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = () => reject(new Error('Tesseract.js ë¡œë“œ ì‹¤íŒ¨'));
                    });
                }

                const result = await Tesseract.recognize(imgData, 'kor+eng', {
                    logger: m => {
                        if (m.status === 'recognizing text') {
                            const pct = Math.round((m.progress || 0) * 100);
                            const loadingEl = document.querySelector('#screenshotLoading span');
                            if (loadingEl) loadingEl.textContent = `ì´ë¯¸ì§€ì—ì„œ ì´ë¦„ì„ ì¶”ì¶œí•˜ëŠ” ì¤‘... ${pct}%`;
                        }
                    }
                });

                const rawText = result.data.text || '';

                // ì˜ì–´ â†’ í•œê¸€ ë°œìŒ ë³€í™˜ ë§µ
                const engToKor = {
                    'a':'ì—ì´','b':'ë¹„','c':'ì”¨','d':'ë””','e':'ì´','f':'ì—í”„',
                    'g':'ì§€','h':'ì—ì´ì¹˜','i':'ì•„ì´','j':'ì œì´','k':'ì¼€ì´','l':'ì—˜',
                    'm':'ì— ','n':'ì—”','o':'ì˜¤','p':'í”¼','q':'í','r':'ì•Œ',
                    's':'ì—ìŠ¤','t':'í‹°','u':'ìœ ','v':'ë¸Œì´','w':'ë”ë¸”ìœ ','x':'ì—‘ìŠ¤',
                    'y':'ì™€ì´','z':'ì œíŠ¸',
                    'gay':'ê²Œì´','lecode':'ë ˆì½”ë“œ','somu':'ì†Œë¬´',
                };

                function convertName(name) {
                    // 1. íŠ¹ìˆ˜ë¬¸ì ì „ë¶€ ì œê±° (í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ë‚¨ê¹€)
                    let cleaned = name.replace(/[^ê°€-í£a-zA-Z0-9\s]/g, '').trim();
                    if (!cleaned) return '';

                    // 2. ìˆ«ìë§Œ ìˆìœ¼ë©´ ì œê±°
                    if (/^\d+$/.test(cleaned)) return '';

                    // 3. ì˜ì–´ ë‹¨ì–´ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ í•œê¸€ë¡œ ë³€í™˜
                    const lowerCleaned = cleaned.toLowerCase();
                    // ë¨¼ì € ì „ì²´ ë‹¨ì–´ ë§¤ì¹­ ì‹œë„
                    if (engToKor[lowerCleaned]) return engToKor[lowerCleaned];
                    
                    // í•œê¸€ì´ í•˜ë‚˜ë„ ì—†ê³  ì˜ì–´ë§Œ ìˆìœ¼ë©´ â†’ ê·¸ëŒ€ë¡œ ìœ ì§€ (ë‹‰ë„¤ì„ì¼ ìˆ˜ ìˆìŒ)
                    // í•œê¸€ì´ ì„ì—¬ ìˆìœ¼ë©´ ì˜ì–´ ë¶€ë¶„ë§Œ ì œê±°
                    const hasKorean = /[ê°€-í£]/.test(cleaned);
                    if (hasKorean) {
                        // í•œê¸€ë§Œ ì¶”ì¶œ
                        cleaned = cleaned.replace(/[a-zA-Z0-9]/g, '').trim();
                    }
                    // ì˜ì–´ë§Œ ìˆëŠ” ê²½ìš°ëŠ” ê·¸ëŒ€ë¡œ (ê²Œì„ ë‹‰ë„¤ì„)
                    return cleaned;
                }

                const names = rawText.split('\n')
                    .map(line => convertName(line))
                    .filter(name => name.length > 0);

                document.getElementById('screenshotLoading').classList.remove('active');
                document.getElementById('screenshotPreview').classList.add('active');

                const textarea = document.getElementById('screenshotNames');
                if (names.length > 0) {
                    textarea.value = names.join('\n');
                } else {
                    textarea.value = '';
                    textarea.placeholder = 'OCR ì¸ì‹ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”...';
                }
                textarea.focus();
                playClickSound();

            } catch (err) {
                console.error('OCR ì—ëŸ¬:', err);
                document.getElementById('screenshotLoading').classList.remove('active');
                document.getElementById('screenshotPreview').classList.add('active');

                const textarea = document.getElementById('screenshotNames');
                textarea.value = '';
                textarea.placeholder = 'OCR ë¡œë“œ ì‹¤íŒ¨. ì´ë¦„ì„ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”...';
                textarea.focus();
            }
        }

        function applyScreenshotNames() {
            const text = document.getElementById('screenshotNames').value.trim();
            if (!text) return alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');

            const names = text.split('\n')
                .map(n => n.trim())
                .filter(n => n.length > 0);

            if (names.length === 0) return alert('ì¶”ê°€í•  ì´ë¦„ì´ ì—†ìŠµë‹ˆë‹¤!');

            const existingNames = new Set(savedPlayers.map(p => p.name));
            let addedCount = 0;
            let skippedNames = [];

            names.forEach(name => {
                if (existingNames.has(name)) {
                    skippedNames.push(name);
                } else {
                    savedPlayers.push({ id: nextPlayerId++, name, tier: 3, role: 'ëœë¤' });
                    existingNames.add(name);
                    addedCount++;
                }
            });

            saveCurrentTemplate();
            updateSavedPlayersUI();
            cancelScreenshot();

            playSuccessSound();

            let msg = `âœ… ${addedCount}ëª… ì¶”ê°€ ì™„ë£Œ!`;
            if (skippedNames.length > 0) {
                msg += `\nâš ï¸ ì¤‘ë³µ ê±´ë„ˆëœ€: ${skippedNames.join(', ')}`;
            }
            alert(msg);
        }

        function cancelScreenshot() {
            document.getElementById('screenshotUploadArea').style.display = '';
            document.getElementById('screenshotLoading').classList.remove('active');
            document.getElementById('screenshotPreview').classList.remove('active');
            document.getElementById('screenshotNames').value = '';
            document.getElementById('screenshotFileInput').value = '';
        }

        init();
    </script>
</body>
</html>
